if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.BarChart=function(parent,config){var me=this;var defaultConfig={layout:"vertical",animationSteps:1500,stackValues:false,borderRadius:0,colors:d3.schemeCategory10,showTooltip:false,sort:false};var svg,chart,plotArea;var x,y;var xAxis,yAxis;var layers=[];var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;chart=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);};this.getBarColor=function(d,i,arr){var colors=config.colors;var barColor=config["barColor"+i];if(!barColor){barColor=colors[i%colors.length];config["barColor"+i]=barColor;}
return barColor;};this.getTooltipLabel=function(d,i,data){var label=me.getKeyLabel(d.key,d)+"<br/>"+me.getValueLabel(d.value);var group=config.group;if(group){group=(group+"").trim();if(group.length>0){try{label=group+": "+data[0][config.group]+"<br/>"+label;}
catch(e){}}}
return label;};this.getKeyLabel=function(key,data){var xKey,yKey;var layout=config.layout;if(layout==="horizontal"){yKey=config.xAxis;xKey=config.yAxis;}
else{xKey=config.xAxis;yKey=config.yAxis;}
return xKey+": "+key;};this.getValueLabel=function(value,data){var xKey,yKey;var layout=config.layout;if(layout==="horizontal"){yKey=config.xAxis;xKey=config.yAxis;}
else{xKey=config.xAxis;yKey=config.yAxis;}
var val=bluewave.chart.utils.parseFloat(value);if(!isNaN(val))value=round(val,2);return yKey+": "+value;};this.getXAxis=function(){return xAxis;};this.getYAxis=function(){return yAxis;};this.clear=function(){if(chart)chart.selectAll("*").remove();};this.addLine=function(line,data,xAxis,yAxis){layers.push({line:line,data:data,xAxis:xAxis+"",yAxis:yAxis+""});};this.update=function(chartConfig,data){me.clear();if(arguments.length>1){me.setConfig(chartConfig);}
else{data=arguments[0];}
checkSVG(me,function(){renderChart(data);});};this.getSVG=function(){return svg;};var renderChart=function(data){var chartConfig=config;var rect=javaxt.dhtml.utils.getRect(svg.node());var width=rect.width;var height=rect.height;var axisHeight=height;var axisWidth=width;plotArea=chart.append("g");plotArea.attr("width",width).attr("height",height);var layout=chartConfig.layout;var stackValues=chartConfig.stackValues===true;var r=parseInt(chartConfig.borderRadius);if(isNaN(r)||r<0)r=0;var xKey;var yKey;var barType=chartConfig.barType;if(barType==="histogram"){xKey=chartConfig.values;yKey=xKey;}
else{if(layout==="horizontal"){yKey=chartConfig.xAxis;xKey=chartConfig.yAxis;}
else{xKey=chartConfig.xAxis;yKey=chartConfig.yAxis;}}
if((xKey===null||xKey===undefined)||(yKey===null||yKey===undefined))return;var dataSets=data;var mergedData=d3.merge(dataSets);var maxData=createKeyValueDataset(mergedData,xKey,yKey);if(layers.length>0){let max=d3.max(maxData,d=>bluewave.chart.utils.parseFloat(d.value));layers.forEach(function(l){let lineData=l.data;let xKey=l.xAxis;let yKey=l.yAxis;let lineMax=d3.max(lineData,d=>bluewave.chart.utils.parseFloat(d[yKey]));if(lineMax>max){maxData=createKeyValueDataset(lineData,xKey,yKey);}});}
var group=chartConfig.group;if(group){group=(group+"").trim();if(group.length===0)group=null;}
if(group){dataSets=[];var map=d3.group(mergedData,d=>d[group]);for(var key of map.keys()){var arr=map.get(key);var groupName=arr[0][group];var temp={};arr.forEach((d)=>{var key=d[xKey];var val=bluewave.chart.utils.parseFloat(d[yKey]);if(isNaN(val))val=0;if(temp.hasOwnProperty(key)){temp[key]+=val;}
else{temp[key]=val;}});arr=[];for(var key in temp){if(temp.hasOwnProperty(key)){var val=temp[key];var entry={};entry[group]=groupName;entry[xKey]=key;entry[yKey]=val;arr.push(entry);}}
dataSets.push(arr);};}
else{stackValues=false;}
var arr=[];for(let i=0;i<dataSets.length;i++){var n=i>0?(i+1):"";let xAxisN=chartConfig[`xAxis${i+1}`];let yAxisN=chartConfig[`yAxis${i+1}`];if((!xAxisN||!yAxisN)&&!group&&barType!=="histogram"&&i>0)continue;if(chartConfig.hasOwnProperty(`xAxis${i+1}`)&&chartConfig.hasOwnProperty(`yAxis${i+1}`)){xKey=xAxisN;yKey=yAxisN;}
var sumData=createKeyValueDataset(dataSets[i],xKey,yKey);arr.push(sumData);}
if(stackValues){maxData=createKeyValueDataset(d3.merge(arr),"key","value");}
else{maxData=[];arr.forEach((sumData)=>{maxData.push(...sumData);});}
var sort=(config.sort+"").toLowerCase();if(sort==="ascending"||sort==="descending"){maxData.sort(function(a,b){return d3[sort](a.value,b.value);});}
var leftLabel,bottomLabel;var axisKey,axisValue;if(barType==="histogram"){axisKey="key";axisValue="key";if(layout==="vertical"){leftLabel="Frequency";bottomLabel=chartConfig.xAxis;}
else if(layout==="horizontal"){leftLabel=chartConfig.xAxis;bottomLabel="Frequency";}}
else{if(layout==="vertical"){axisKey="key";axisValue="value";leftLabel=chartConfig.yAxis;bottomLabel=chartConfig.xAxis;}
else if(layout==="horizontal"){axisKey="value";axisValue="key";leftLabel=chartConfig.xAxis;bottomLabel=chartConfig.yAxis;}}
var axes=drawAxes(plotArea,axisWidth,axisHeight,axisKey,axisValue,maxData,null,chartConfig,"barChart");var margin=axes.margin;if(margin){var marginLeft=margin.left;var marginRight=margin.right;var marginTop=margin.top;var marginBottom=margin.bottom;if(marginTop>0||marginBottom>0||marginLeft>0||marginRight>0){axisHeight-=(marginTop+marginBottom);axisWidth-=(marginLeft+marginRight);plotArea.selectAll("*").remove();plotArea.attr("transform","translate("+marginLeft+","+marginTop+")");axes=drawAxes(plotArea,axisWidth,axisHeight,axisKey,axisValue,maxData,null,chartConfig,"barChart");}
margin={top:marginTop,right:marginRight,bottom:marginBottom,left:marginLeft};}
x=axes.x;y=axes.y;xAxis=axes.xAxis;yAxis=axes.yAxis;height=height-(margin.top+margin.bottom);width=width-(margin.left+margin.right);var defs;if(r)defs=plotArea.append("defs");var barGroup=plotArea.append("g");var keyMap={};for(let i=0;i<dataSets.length;i++){var g=barGroup.append("g");var id=(Math.random()+1).toString(36).substring(7);var sumData=arr[i];var _x,_y,getWidth,getHeight;if(stackValues){let keyType=getType(sumData[0].key);if(keyType==="date")keyType="string";_x=function(d){if(keyType==="date"){return x(new Date(d.key));}
else{return x(d.key);}};_y=function(d){var key=d.key;var val=d.value;if(!keyMap[key])keyMap[key]=0;var v=bluewave.chart.utils.parseFloat(val);keyMap[key]+=v;return y(keyMap[key]);};let getY=function(d){var v=bluewave.chart.utils.parseFloat(d["value"]);return y(v);};getWidth=function(d){return x.bandwidth?x.bandwidth():_x(d);};getHeight=function(d){return y.bandwidth?y.bandwidth():(height-getY(d));};}
else{if(barType==="histogram"){let binWidth=parseInt(chartConfig.binWidth);if(isNaN(binWidth)||binWidth<1)binWidth=10;x.nice();var histogram=d3.histogram().value(function(d){return d.key;}).domain(x.domain()).thresholds(x.ticks(binWidth));var bins=histogram(sumData);var frequencyMax=d3.max(bins,d=>d.length)
var frequencyAxis=d3.scaleLinear().range(layout==="vertical"?[height,0]:[0,width]);frequencyAxis.domain([0,frequencyMax]);if(layout==="vertical")displayHistogramAxis(x,frequencyAxis,axisHeight);else if(layout==="horizontal")displayHistogramAxis(frequencyAxis,y,axisHeight);_x=function(d){return(layout==="vertical")?x(d.x0):0;};_y=function(d){return(layout==="vertical")?frequencyAxis(d.length):height-x(d.x1)/(width/height)};getWidth=function(d){return(layout==="vertical")?(x(d.x1)-x(d.x0)-0.5):frequencyAxis(d.length);};getHeight=function(d){return(layout==="vertical")?height-frequencyAxis(d.length):(x(d.x1)-x(d.x0))/(width/height)-0.5;};}
else{let keyType=getType(sumData[0].key);if(keyType==="date")keyType="string";var getX=function(d){if(keyType==="date"){return x(new Date(d.key));}
else{return x(d.key);}};var getY=function(d){var v=bluewave.chart.utils.parseFloat(d["value"]);return y(v);};if(y.bandwidth||x.bandwidth){if(chartConfig.layout==="vertical"){getWidth=function(d){if(group||dataSets.length>1){return x.bandwidth?x.bandwidth()/dataSets.length:getX(d);}
else{return x.bandwidth?x.bandwidth():getX(d);}};getHeight=function(d){return y.bandwidth?y.bandwidth():height-getY(d);};_x=function(d){var w=getWidth(d);var left=x.bandwidth?getX(d):0;return(group||dataSets.length>1)?left+(w*i):getX(d);};_y=getY;}
else if(chartConfig.layout==="horizontal"){_x=function(){return 0;};_y=function(d){var w=y.bandwidth?y.bandwidth()/dataSets.length:height-y(d["key"]);var left=y.bandwidth?y(d["key"]):0;return group?left+(w*i):y(d["key"]);};getWidth=function(d){return x.bandwidth?x.bandwidth():x(d["value"]);};getHeight=function(d){if(group){return y.bandwidth?y.bandwidth()/dataSets.length:height-y(d["value"]);}
else{return y.bandwidth?y.bandwidth():height-y(d["value"]);}};}}
else{if(chartConfig.layout==="vertical"){_x=function(d){var xStart=getX(d)-width/sumData.length/2;if(group){var maxWidth=width/sumData.length;var barWidth=maxWidth/dataSets.length;xStart+=(barWidth*i);}
return xStart;};_y=getY;getHeight=function(d){return height-getY(d);};getWidth=function(d){var maxWidth=width/sumData.length;if(group){return(maxWidth/dataSets.length);}
else{return maxWidth-5;}};}
else if(chartConfig.layout==="horizontal"){_x=function(d){return 0;};_y=function(d){if(keyType==="date"){return y(new Date(d.key))-height/sumData.length/2;}
else{return y(d.key)-height/sumData.length/2;}};getHeight=function(d){return height/sumData.length-5;};getWidth=function(d){return x(d["value"]);};}}}}
if(r){if(stackValues){console.log(i);r=0;}
else{defs.selectAll("*").data(sumData).enter().append("clipPath").attr("id",function(d,n,j){return"round-corner-"+id+n;}).append("rect").attr("rx",r).attr("ry",r).attr("x",function(d){if(chartConfig.layout==="vertical"){return _x(d);}
else if(chartConfig.layout==="horizontal"){return _x(d)-r;}}).attr("y",_y).attr("height",function(d){if(chartConfig.layout==="vertical"){return getHeight(d)+r;}
else if(chartConfig.layout==="horizontal"){return getHeight(d);}}).attr("width",function(d){if(chartConfig.layout==="vertical"){return getWidth(d);}
else if(chartConfig.layout==="horizontal"){return getWidth(d)+r;}});}}
g.selectAll("*").data(sumData).enter().append("rect").attr("x",_x).attr("y",_y).attr("height",getHeight).attr("width",getWidth).attr("clip-path",function(d,n,j){if(r)return"url(#round-corner-"+id+n+")";else return"";}).attr("barID",function(d,n,j){return i;});}
var getBarData=function(barID,d){var arr=[];var dataSet=dataSets[barID];for(var j=0;j<dataSet.length;j++){if(dataSet[j][xKey]===d.key){arr.push(dataSet[j]);}}
return arr;};var bars=barGroup.selectAll("rect");var opacities={};bars.each(function(d,i){let bar=d3.select(this);let barID=parseInt(bar.attr("barID"));var arr=getBarData(barID,d);var fillColor=me.getBarColor(d,barID,arr);var fillOpacity=opacities[barID];if(isNaN(fillOpacity)){fillOpacity=bluewave.chart.utils.parseFloat(chartConfig["fillOpacity"+barID]);if(isNaN(fillOpacity)||fillOpacity<0||fillOpacity>1)fillOpacity=1;chartConfig["fillOpacity"+barID]=fillOpacity;opacities[barID]=fillOpacity;}
bar.attr("fill",fillColor);bar.attr("opacity",fillOpacity);});var animationSteps=chartConfig.animationSteps;if(!isNaN(animationSteps)&&animationSteps>50){var clips;if(r){clips=defs.selectAll("rect");clips.attr("yInitial",function(){return this.getAttribute("y");}).attr("heightInitial",function(){return this.getAttribute("height");}).attr("widthInitial",function(){return this.getAttribute("width");});}
else{bars.attr("yInitial",function(){return this.getAttribute("y");}).attr("heightInitial",function(){return this.getAttribute("height");}).attr("widthInitial",function(){return this.getAttribute("width");});}
if(layout==="vertical"){if(clips){clips.attr("y",height).attr("height",r);clips.transition().duration(animationSteps).attr("y",function(){return parseFloat(this.getAttribute("yInitial"));}).attr("height",function(){return parseFloat(this.getAttribute("heightInitial"));});}
else{bars.attr("y",height).attr("height",0);bars.transition().duration(animationSteps).attr("y",function(){return parseFloat(this.getAttribute("yInitial"));}).attr("height",function(){return parseFloat(this.getAttribute("heightInitial"));});}}
else if(layout==="horizontal"){if(clips){clips.attr("width",0);clips.transition().duration(animationSteps).attr("width",function(){return parseFloat(this.getAttribute("widthInitial"));});}
else{bars.attr("x",0).attr("width",0);bars.transition().duration(animationSteps).attr("width",function(){return parseFloat(this.getAttribute("widthInitial"));});}}}
var tooltip;if(config.showTooltip===true){tooltip=createTooltip();}
var mouseover=function(e,d){let bar=d3.select(this);if(tooltip){let barID=parseInt(bar.attr("barID"));var arr=getBarData(barID,d);var label=me.getTooltipLabel(d,barID,arr);tooltip.html(label).show();}
var opacity=parseFloat(bar.attr("opacity"));opacity=opacity-(opacity*0.2);bar.transition().duration(100).attr("opacity",opacity);};var mousemove=function(e){if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(){if(tooltip)tooltip.hide();let bar=d3.select(this);let barID=parseInt(bar.attr("barID"));var fillOpacity=opacities[barID];bar.transition().duration(100).attr("opacity",fillOpacity);};var addMouseEvents=function(){if(!animationSteps)animationSteps=0;setTimeout(function(){bars.on("mouseover",mouseover);bars.on("mousemove",mousemove);bars.on("mouseleave",mouseleave);},animationSteps);};var getSiblings=function(bar){var arr=[];bars.each(function(){arr.push(this);});return arr;};bars.on("click",function(e,d){var barID=parseInt(d3.select(this).attr("barID"));me.onClick(this,barID,d);});bars.on("dblclick",function(e,d){me.onDblClick(this,getSiblings(this));});layers.forEach(function(layer){renderLine(layer);});if(chartConfig.xGrid||chartConfig.yGrid){var xTicks=false;if(chartConfig.xGrid===true){xTicks=bluewave.chart.utils.parseFloat(chartConfig.xTicks);}
var yTicks=false;if(chartConfig.yGrid===true){yTicks=bluewave.chart.utils.parseFloat(chartConfig.yTicks);}
drawGridlines(plotArea,x,y,axisHeight,axisWidth,xTicks,yTicks);}
addMouseEvents();};this.onClick=function(bar,bars){};this.onDblClick=function(bar,bars){};var displayHistogramAxis=function(x,y,axisHeight){if(xAxis)xAxis.selectAll("*").remove();if(yAxis)yAxis.selectAll("*").remove();xAxis=plotArea.append("g").attr("transform","translate(0,"+axisHeight+")").call(d3.axisBottom(x));xAxis.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");yAxis=plotArea.append("g").call(d3.axisLeft(y));};var renderLine=function(layer){var xKey=layer.xAxis;var yKey=layer.yAxis;var lineConfig;if(layer.line.getConfig)lineConfig=layer.line.getConfig();if(!lineConfig)lineConfig=new bluewave.chart.Line().getConfig();let lineColor=lineConfig.color;let lineStyle=lineConfig.style;let lineWidth=lineConfig.width;let opacity=lineConfig.opacity;let smoothing=lineConfig.smoothing;var getX=function(d){var xoffset=x.bandwidth()/2;if(keyType==="date"){return x(new Date(d.key))+xoffset;}else{return x(d.key)+xoffset;}};var getY=function(d){var v=bluewave.chart.utils.parseFloat(d["value"]);return y(v);};var getLine=function(){if(smoothing&&smoothing!=="none"){return d3.line().x(getX).y(getY).curve(d3[smoothing]);}
return d3.line().x(getX).y(getY);};var sumData=createKeyValueDataset(layer.data,xKey,yKey);let keyType=getType(sumData[0].key);if(keyType=="date")keyType="string";plotArea.append("path").datum(sumData).attr("fill","none").attr("stroke",lineColor).attr("stroke-width",lineWidth).attr("opacity",opacity).attr("stroke-dasharray",function(d){if(lineStyle==="dashed")return"5, 5";else if(lineStyle==="dotted")return"0, 5";}).attr("stroke-linecap",function(d){if(lineStyle==="dotted")return"round";}).attr("d",getLine());};var merge=javaxt.dhtml.utils.merge;var checkSVG=bluewave.chart.utils.checkSVG;var initChart=bluewave.chart.utils.initChart;var drawAxes=bluewave.chart.utils.drawAxes;var createTooltip=bluewave.chart.utils.createTooltip;var drawGridlines=bluewave.chart.utils.drawGridlines;var getType=bluewave.chart.utils.getType;var createKeyValueDataset=bluewave.chart.utils.createKeyValueDataset;var round=javaxt.dhtml.utils.round;init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.CalendarChart=function(parent,config){var me=this;var defaultConfig={dayLabel:true,yearLabel:true,date:"date",value:"value",weekday:"sunday",colors:["#fff","#ebf5dc","#cbe9a5","#2a671a"],numClasses:10,boundaryColor:"#fff",showTooltip:false};var svg,chart,calendarArea;var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;chart=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);};this.onClick=function(el,d){};this.getCell=function(date){date=new Date(date);var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var el=null;calendarArea.selectAll("rect").each(function(date){var y=date.getFullYear();var m=date.getMonth();var d=date.getDate();if(y===year&&m===month&&d===day){el=this;}});return el;};this.getTooltipLabel=function(d){return d3.utcFormat("%m/%d/%Y")(d.date)+"<br/>"+d3.format(",")(d.value);};this.clear=function(){if(chart)chart.selectAll("*").remove();};this.update=function(chartConfig,data){me.clear();if(arguments.length>1){config=merge(chartConfig,defaultConfig);}
else{data=arguments[0];}
checkSVG(me,function(){renderChart(data);});};this.getSVG=function(){return svg;};var renderChart=function(data){me.clear();var chartConfig=config;var rect=javaxt.dhtml.utils.getRect(svg.node());var width=rect.width;var height=rect.height;calendarArea=chart.append("g");calendarArea.attr("width",width).attr("height",height);var
weekday=config.weekday,formatDay=i=>"SMTWTFS"[i];const countDay=weekday==="sunday"?i=>i:i=>(i+6)%7;const timeWeek=weekday==="sunday"?d3.utcSunday:d3.utcMonday;const weekDays=weekday==="weekday"?5:7;data.forEach((d)=>{var date=d[config.date];var value=d[config.value];d[config.date]=new Date(date);d[config.value]=bluewave.chart.utils.parseFloat(value);});data.sort(function(a,b){return b[config.date].getTime()-a[config.date].getTime();});var dates=[];var values=[];var years={};var weeks={};data.forEach((d)=>{var date=d[config.date];var value=d[config.value];dates.push(date);values.push(value);var year=date.getUTCFullYear();years[year+""]=year;var week=timeWeek.count(d3.utcYear(date),date);weeks[week+""]=parseInt(week);});years=Object.values(years);years.sort(function(a,b){return b-a;});var numWeeks=0;var range=d3.extent(Object.values(weeks));for(var i=0;i<=range[1];i++)numWeeks++;var xOffset=0;var maxWidth=width;if(chartConfig.dayLabel)xOffset=15;if(chartConfig.yearLabel)xOffset=Math.max(40,xOffset);var cellSize=Math.floor((maxWidth-xOffset)/numWeeks);var breaks=getNaturalBreaks(values,config.numClasses);var colors=getColorRange(breaks.length+1,config.colors);var getColor=function(value){for(var i=0;i<breaks.length-1;i++){var currBreak=breaks[i];var nextBreak=breaks[i+1];var color=colors[i];if(value>=currBreak&&value<nextBreak){return color;}
else{if(value==breaks[breaks.length-1]){return colors[colors.length-1];}}}};var tooltip;if(config.showTooltip===true){tooltip=createTooltip();}
var mouseover=function(e,d){if(tooltip){var i=cells.nodes().indexOf(this);var label=me.getTooltipLabel({date:d,value:values[i]});tooltip.html(label).show();}
d3.select(this).transition().duration(100).attr("opacity","0.8");};var mousemove=function(e){if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(){if(tooltip)tooltip.hide();d3.select(this).transition().duration(100).attr("opacity","1");};const groupHeight=cellSize*(weekDays+2);var yearGroup=calendarArea.selectAll("*").data(years).join("g").attr("transform",(d,i)=>`translate(${xOffset-0.5},${groupHeight * i + cellSize * 1.5})`);if(chartConfig.yearLabel){yearGroup.append("text").attr("class","chart-axis-label").attr("x",-5).attr("y",-5).attr("text-anchor","end").text(year=>year);}
if(chartConfig.dayLabel){yearGroup.append("g").attr("class","day label").attr("text-anchor","middle").selectAll("text").data(function(year){var arr=d3.range(7);arr.forEach(function(d,i){arr[i]={day:d,year:year};});return arr;}).join("text").attr("x",-10).attr("y",function(d){return(countDay(d.day)+0.5)*cellSize;}).attr("dy","0.31em").text(function(d){return formatDay(d.day);});}
var cells=yearGroup.append("g").selectAll("*").data(function(year){var arr=[];dates.forEach(function(date){if(date.getUTCFullYear()===year)arr.push(date);});return arr;}).join("rect").attr("width",cellSize-1).attr("height",cellSize-1).attr("x",date=>timeWeek.count(d3.utcYear(date),date)*cellSize+0.5).attr("y",date=>countDay(date.getUTCDay())*cellSize+0.5).attr("fill",function(date,i){var value=values[i];var color=getColor(value);if(color===config.colors[0]&&value>0){color=colors[1];}
return color;}).on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave).on("click",function(e,d){var i=cells.nodes().indexOf(this);me.onClick(this,{date:d,value:values[i]});});var monthGroup=yearGroup.append("g").selectAll("g").data(function(year){var firstDay,lastDate;dates.forEach(function(date){if(date.getUTCFullYear()===year){if(!lastDate)lastDate=date;firstDay=date;}});firstDay=new Date(firstDay.getTime());lastDate=new Date(lastDate.getTime());firstDay.setMonth(firstDay.getMonth()-1);lastDate.setMonth(lastDate.getMonth()+1);return d3.utcMonths(firstDay,lastDate);}).join("g");monthGroup.filter((d,i)=>i).append("path").attr("fill","none").attr("stroke",config.boundaryColor).attr("stroke-width",3).attr("d",function(date){const d=Math.max(0,Math.min(weekDays,countDay(date.getUTCDay())));const w=timeWeek.count(d3.utcYear(date),date);return`${d === 0 ? `M${w*cellSize},0`
                    : d === weekDays ? `M${(w+1)*cellSize},0`
                    : `M${(w+1)*cellSize},0V${d*cellSize}H${w*cellSize}`}V${weekDays * cellSize}`;});var renderedMonths={};monthGroup.append("text").attr("class","month label").attr("x",d=>timeWeek.count(d3.utcYear(d),timeWeek.ceil(d))*cellSize+2).attr("y",-5).text(function(date){var month=d3.utcFormat("%b")(date);var year=d3.utcFormat("%Y")(date);var key=year+"-"+month;var dateInRange=false;dates.every(function(d){var m=d3.utcFormat("%b")(d);var y=d3.utcFormat("%Y")(d);var k=y+"-"+m;if(k===key){dateInRange=true;return false;}
return true;});if(dateInRange){if(!renderedMonths[key]){renderedMonths[key]=true;return month;}}});};var merge=javaxt.dhtml.utils.merge;var checkSVG=bluewave.chart.utils.checkSVG;var initChart=bluewave.chart.utils.initChart;var createTooltip=bluewave.chart.utils.createTooltip;var getColorRange=bluewave.chart.utils.getColorRange;var getNaturalBreaks=bluewave.chart.utils.getNaturalBreaks;init();};
if(!bluewave){var bluewave={}}if(!bluewave.charts){bluewave.charts={}}bluewave.charts.ForceDirectedChart=function(i,b){var g=this;var d={getNodeLabel:function(l){return l.name},getNodeFill:function(l){return"#dcdcdc"},getNodeOutline:function(l){return"#777"},getNodeRadius:function(l){return 10}};var e,a;var j=function(){b=h(b,d);f(i,function(l,m){e=l;a=m;e.call(d3.zoom().on("zoom",function(){a.attr("transform",d3.event.transform)}));e.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-1.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5")})};this.clear=function(){if(a){a.selectAll("*").remove()}};this.update=function(m,l){g.clear();var n=e.node().parentNode;k(n,function(){c(m,l)})};var c=function(l,w){g.clear();var r=a.append("g");var q=i.offsetWidth/2;var p=i.offsetHeight/2;var v=d3.forceSimulation(l).force("link",d3.forceLink().id(function(x){return x.name})).force("charge",d3.forceManyBody()).force("center",d3.forceCenter(q,p));var t=r.append("g").selectAll("line").data(w).enter().append("line").style("stroke","#aaa").attr("marker-end","url(#end)");var n=r.append("g").selectAll("circle").data(l).enter().append("circle").attr("transform",function(x){return"translate("+q+","+p+")"}).attr("r",function(x){return b.getNodeRadius.apply(g,[x])}).style("fill",function(x){return b.getNodeFill.apply(g,[x])}).attr("stroke-width",1.5).attr("stroke",function(x){return b.getNodeOutline.apply(g,[x])}).on("click",function(x){o(x,this)});var u=r.append("g").selectAll("text").data(l).enter().append("text").text(function(x){return b.getNodeLabel.apply(g,[x])}).attr("fill",function(x){if(x.type==="search"){return"#fff"}else{return"#000"}}).on("click",function(x){o(x,this)});u.each(function(y){var x=d3.select(this).node().getBBox();y.labelWidth=x.width;y.labelHeight=x.height});var s={};n.each(function(x){x.r=parseFloat(d3.select(this).attr("r"));s[x.name]=x});v.nodes(l).on("tick",function(){t.attr("x1",function(C){var A=s[C.source];var z=A.x;var E=A.y;var y=s[C.target].x;var D=s[C.target].y;var x=A.r;var B=Math.sqrt(Math.pow(y-z,2)+Math.pow(D-E,2));var F=x/B;return(1-F)*z+F*y}).attr("y1",function(C){var A=s[C.source];var z=A.x;var E=A.y;var y=s[C.target].x;var D=s[C.target].y;var x=A.r;var B=Math.sqrt(Math.pow(y-z,2)+Math.pow(D-E,2));var F=x/B;return(1-F)*E+F*D}).attr("x2",function(C){var A=s[C.target];var z=A.x;var E=A.y;var y=s[C.source].x;var D=s[C.source].y;var x=A.r;var B=Math.sqrt(Math.pow(y-z,2)+Math.pow(D-E,2));var F=x/B;return(1-F)*z+F*y}).attr("y2",function(C){var A=s[C.target];var z=A.x;var E=A.y;var y=s[C.source].x;var D=s[C.source].y;var x=A.r;var B=Math.sqrt(Math.pow(y-z,2)+Math.pow(D-E,2));var F=x/B;return(1-F)*E+F*D});n.attr("transform",function(x){return"translate("+x.x+","+x.y+")"});u.attr("transform",function(E){var z=E.x;var G=E.y;var D=E.r;var A=E.labelWidth;var C=E.labelHeight;if(E.type==="search"){var B=z-(A/2);var F=G+4;return"translate("+B+","+F+")"}else{var B;if(z>q){B=z+D}else{B=z-(A+D)}return"translate("+B+","+(G-(C/2))+")"}})});var m=function(y,x){w.forEach(function(A){if(A.source===y){var D=A.target;if(!x[D]){m(D,x);if(!x[D]){var z=0;for(var C in x){if(x.hasOwnProperty(C)){z++}}var B="n"+z;x[D]={alias:B,source:y,join:"-[:"+A.relationship+"]->"}}}}})};var o=function(A,y){var z=A.name;var x={};m(z,x);n.each(function(){d3.select(this).style("opacity",function(B){if(B.name===z){return 1}return x[B.name]?1:0.15})});t.each(function(){d3.select(this).style("opacity",function(B){if(s[B.source].name===z){return 1}return x[s[B.source].name]?1:0.15})});u.each(function(){d3.select(this).style("opacity",function(B){if(B.type==="search"){}else{if(B.name===z){return 1}return x[B.name]?1:0.35}})})}};var h=javaxt.dhtml.utils.merge;var k=javaxt.dhtml.utils.onRender;var f=bluewave.chart.utils.initChart;j()};
if(!bluewave)var bluewave={};if(!bluewave.chart)bluewave.chart={};bluewave.chart.Line=function(config){var me=this;var defaultConfig={color:"#6699CC",opacity:1,width:1,style:"solid",fill:{color:"#6699CC",startOpacity:0,endOpacity:0},point:{color:"#6699CC",radius:0},label:"",smoothing:"none",smoothingValue:0};var init=function(){if(!config){config=defaultConfig;return;}
var chartConfig=config;config=defaultConfig;me.setConfig(chartConfig);};this.setColor=function(color){color=getColor(color);if(color)config.color=color;};this.setOpacity=function(opacity){opacity=getOpacity(opacity);if(!isNaN(opacity))config.opacity=opacity;};this.setWidth=function(width){width=parseFloat(width);if(!isNaN(width)){if(width>0)config.width=width;}};this.setStyle=function(style){if(!style)return;style=(style+"").toLowerCase();if(style==="solid"||style==="dashed"||style==="dotted"){config.style=style;}};this.setFill=function(fill){if(!fill){delete config.fill;}
else{var color=getColor(fill.color);if(color)config.fill.color=color;var opacity=getOpacity(fill.startOpacity);if(!isNaN(opacity))config.fill.startOpacity=opacity;var opacity=getOpacity(fill.endOpacity);if(!isNaN(opacity))config.fill.endOpacity=opacity;}};this.setPoint=function(point){if(!point){delete config.point;}
else{var color=getColor(point.color);if(color)config.point.color=color;var radius=parseFloat(point.radius);if(!isNaN(radius)){if(radius>0)config.point.radius=radius;}}};this.setLabel=function(label){config.label=label;};this.setSmoothing=function(smoothing){if(!smoothing)return;smoothing=(smoothing+"").toLowerCase();switch(smoothing){case"spline":case"simple spline":smoothing="spline";break;case"moving average":case"movingaverage":smoothing="movingAverage";break;case"kernel density estimation":case"kde":smoothing="kde";break;case"curvenatural":smoothing="curveNatural";break;default:smoothing="none";break;}
config.smoothing=smoothing;};this.setSmoothingValue=function(smoothingValue){smoothingValue=parseFloat(smoothingValue);if(isNaN(smoothingValue)||smoothingValue<0){}
else config.smoothingValue=smoothingValue;};this.getConfig=function(){return config;};this.setConfig=function(chartConfig){for(var key in chartConfig){if(chartConfig.hasOwnProperty(key)){var method="set"+key.substring(0,1).toUpperCase()+key.substring(1);if(me[method])me[method].apply(me,[chartConfig[key]]);}}};this.getColor=()=>config.color;this.getWidth=()=>config.width;this.getStyle=()=>config.style;this.getFill=()=>config.fill;this.getPoint=()=>config.point;this.getLabel=()=>config.label;this.getSmoothing=()=>config.smoothing;this.getSmoothingValue=()=>config.smoothingValue;this.clone=function(){let copy=Object.assign({},config);return new bluewave.chart.Line(copy);};var getColor=function(color){return color;};var getOpacity=function(opacity){opacity=parseFloat(opacity);if(isNaN(opacity))return null;if(opacity<0||opacity>1)return null;return opacity;};init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.LineChart=function(parent,config){var me=this;var defaultConfig={xGrid:false,yGrid:false,xTicks:true,yTicks:true,scaling:"linear",stackValues:false,accumulateValues:false,endTags:false,showTooltip:false,animationSteps:1500,labelPadding:3};var svg,chart,plotArea;var x,y;var xAxis,yAxis;var layers=[];var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;chart=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);me.setScaling(config.scaling);};this.setScaling=function(scale){config.scaling=scale==="logarithmic"?"logarithmic":"linear";};this.displayEndTags=function(b){config.endTags=b===true?true:false;};this.getTooltipLabel=function(d,i){return me.getKeyLabel(d.key,d)+"<br/>"+me.getValueLabel(d.value);};this.getKeyLabel=function(key,data){var type=getType(key);if(type=="date"){if(!(key instanceof Date))key=new Date(key);return(key.getMonth()+1)+"/"+key.getDate()+"/"+key.getFullYear();}
else{return key;}};this.getValueLabel=function(value,data){var val=bluewave.chart.utils.parseFloat(value);if(isNaN(val))return value;return round(val,2);};this.getXAxis=function(){return xAxis;};this.getYAxis=function(){return yAxis;};this.onClick=function(line,datasetID,renderedData){};this.clear=function(){clearChart();layers=[];};this.update=function(){checkSVG(me,function(){renderChart();});};this.getSVG=function(){return svg;};this.addLine=function(line,data,xAxis,yAxis){layers.push({line:line,data:data,xAxis:xAxis+"",yAxis:yAxis+""});};this.getLayers=function(){return layers;};this.setLayers=function(arr){layers=arr;};var clearChart=function(){if(chart)chart.selectAll("*").remove();};var renderChart=function(){clearChart();var chartConfig=config;var data=layers.map(d=>d.data);if(data.length===0)return;var rect=javaxt.dhtml.utils.getRect(svg.node());var width=rect.width;var height=rect.height;var axisHeight=height;var axisWidth=width;plotArea=chart.append("g");plotArea.attr("width",width).attr("height",height);var showLabels=chartConfig.endTags;if(showLabels===true||showLabels===false){}
else showLabels=data.length>1;var stackValues=chartConfig.stackValues===true;var accumulateValues=chartConfig.accumulateValues===true;var showTooltip=chartConfig.showTooltip===true;var xKeys={};layers.forEach(function(layer){if(!layer.data)return;layer.data.forEach(function(d){var xKey=d[layer.xAxis];xKeys[xKey]=xKey;});});xKeys=Object.values(xKeys);var arr=[];for(let i=0;i<layers.length;i++){if(!layers[i].line)continue;let xKey=layers[i].xAxis;let yKey=layers[i].yAxis;if(!xKey||!yKey)continue;var sumData=createKeyValueDataset(layers[i].data,xKey,yKey);var lineConfig=layers[i].line.getConfig();arr.push({lineConfig:lineConfig,sumData:sumData});};sortKeys(xKeys,arr);arr.forEach(function(d){var sumData=d.sumData;var lineConfig=d.lineConfig;var newData=[];var skipKey={};xKeys.forEach(function(key){if(skipKey[key])return;for(var i=0;i<sumData.length;i++){if(sumData[i].key==key){newData.push(sumData[i]);break;}}
skipKey[key]=true;});for(var i=0;i<newData.length;i++){d.sumData[i]=newData[i];}
var sumData=d.sumData;if(accumulateValues){sumData.forEach(function(d,idx){var val=sumData[idx].value;if(isNaN(val))sumData[idx].value=0;if(idx>0){sumData[idx].value+=sumData[idx-1].value;}});}
var smoothingType=lineConfig.smoothing;if(smoothingType){var smoothingValue=lineConfig.smoothingValue;applySmoothing(smoothingType,smoothingValue,sumData);}});if(stackValues){if(accumulateValues){arr.sort(function(a,b){a=a.sumData;a=a[a.length-1].value;b=b.sumData;b=b[b.length-1].value;return b-a;});}
else{var temp=[];arr.forEach(function(d){var sumData=d.sumData;var sumValue=0;sumData.forEach((d)=>sumValue+=d.value);temp.push({sumValue:sumValue,sumData:sumData,lineConfig:d.lineConfig});});temp.sort(function(a,b){return b.sumValue-a.sumValue;});arr=[];temp.forEach((d)=>arr.push({sumData:d.sumData,lineConfig:d.lineConfig}));}
sortKeys(xKeys,arr);arr.forEach(function(d){var sumData=d.sumData;var newData=[];xKeys.forEach(function(key){var val;for(var i=0;i<sumData.length;i++){var k=sumData[i].key;var v=sumData[i].value;if(k==key){val=v;break;}}
newData.push({key:key,value:val});});while(newData.length>0){var firstVal=newData[0].value;if(!isNaN(firstVal))break;if(isNaN(firstVal))newData.shift();}
d.sumData=newData;});var arr2=[];arr.forEach(function(d,i){var sumData=d.sumData;var newData=[];sumData.forEach(function(d){newData.push({key:d.key,value:d.value});});sumData.forEach(function(data,idx){var key=data.key;var val=data.value;if(isNaN(val)){for(var n=idx-1;n>-1;n--){var prevVal=sumData[n].value;if(!isNaN(prevVal)){val=prevVal;break;}}
if(isNaN(val))val=0;}
var prevVals;for(var j=0;j<arr2.length;j++){var prevSumData=arr2[j].sumData;prevSumData.every(function(d){var k=d.key;var v=d.value;if(k==key){if(!isNaN(v)){prevVals=v;return false;}}
return true;});}
if(!isNaN(prevVals))val+=prevVals;newData[idx].value=val;});arr2.push({lineConfig:d.lineConfig,sumData:newData});});arr=arr2;}
var minData=[];var maxData=[];arr.forEach(function(a){var sumData=a.sumData;xKeys.forEach(function(key){if(key instanceof Date&&!stackValues)key=key+"";else{if(!isNaN(key)&&!stackValues){key=key+"";}}
for(var i=0;i<sumData.length;i++){var d=sumData[i];var xKey=d.key;if(xKey===key){var val=d.value;var foundMatch=false;for(var j=0;j<minData.length;j++){var entry=minData[j];if(entry.key==key){foundMatch=true;entry.value=Math.min(entry.value,val);}}
if(!foundMatch){minData.push({key:key,value:val});}
var foundMatch=false;for(var j=0;j<maxData.length;j++){var entry=maxData[j];if(entry.key==key){foundMatch=true;entry.value=Math.max(entry.value,val);}}
if(!foundMatch){maxData.push({key:key,value:val});}}}});});var axes=drawAxes(plotArea,axisWidth,axisHeight,"key","value",maxData,minData,config);var margin=axes.margin;if(margin){var marginLeft=margin.left;var marginRight=margin.right;var marginTop=margin.top;var marginBottom=margin.bottom;if(showLabels){var maxLabelWidth=0;var labelHeight=0;layers.forEach(function(layer,i){if(!layer.line)return;var label=layer.line.getLabel();if(!label)label="Series "+(i+1);if(label){var temp=plotArea.append("text").attr("dy",".35em").attr("text-anchor","start").text(label);var box=temp.node().getBBox();temp.remove();var w=Math.max(box.width+8,60)+5;labelHeight=box.height;maxLabelWidth=Math.max(w,maxLabelWidth);}});marginRight=maxLabelWidth+5;if(labelHeight>0){marginTop=Math.max((labelHeight/2),marginTop);}}
if(marginTop>0||marginBottom>0||marginLeft>0||marginRight>0){axisHeight-=(marginTop+marginBottom);axisWidth-=(marginLeft+marginRight);plotArea.selectAll("*").remove();plotArea.attr("transform","translate("+marginLeft+","+marginTop+")");axes=drawAxes(plotArea,axisWidth,axisHeight,"key","value",maxData,minData,config);}
margin={top:marginTop,right:marginRight,bottom:marginBottom,left:marginLeft};}
x=axes.x;y=axes.y;xAxis=axes.xAxis;yAxis=axes.yAxis;var getX=function(d,i,data){var keyType=data.keyType;if(!keyType)keyType=data.keyType=getType(d.key);if(keyType==="date"){return x(new Date(d.key));}
else{return x(d.key);}};var getY=function(d){var v=bluewave.chart.utils.parseFloat(d.value);return(config.scaling==="logarithmic")?y(v+1):y(v);};var chartElements=[];for(let i=0;i<arr.length;i++){chartElements.push({area:null,line:null,line2:null,tag:null,point:null});}
var tooltip;if(showTooltip)tooltip=createTooltip();var mouseover=function(e,d){if(tooltip){var label=me.getTooltipLabel(d);tooltip.html(label).show();}};var mousemove=function(e){if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(){if(tooltip)tooltip.hide();};var fillGroup=plotArea.append("g");fillGroup.attr("name","fill");var fillClass="fill-gradient-"+(Math.random()+1).toString(36).substring(7);for(let i=arr.length-1;i>-1;i--){let sumData=arr[i].sumData;let lineConfig=arr[i].lineConfig;let fillConfig=lineConfig.fill;let lineColor=fillConfig.color;let startOpacity=fillConfig.startOpacity;let endOpacity=fillConfig.endOpacity;let smoothingType=lineConfig.smoothing;if(startOpacity===0&&endOpacity===0)continue;var getArea=function(){if(smoothingType&&smoothingType==="spline"){return d3.area().x(getX).y0(axisHeight).y1(getY).curve(d3.curveMonotoneX);}
else{return d3.area().x(getX).y0(axisHeight).y1(getY);}};let className=fillClass+"-"+i;addColorGradient(lineColor,startOpacity,endOpacity,className,fillGroup);chartElements[i].area=fillGroup.append("path").datum(sumData).attr("fill",`url(#${className})`).attr("d",getArea());}
var lineGroup=plotArea.append("g");lineGroup.attr("name","lines");var lineGroup2=plotArea.append("g");lineGroup2.attr("name","thicklines");var pointGroup=plotArea.append("g");pointGroup.attr("name","points");for(let i=0;i<arr.length;i++){var sumData=arr[i].sumData;let lineConfig=arr[i].lineConfig;let pointConfig=lineConfig.point;let lineColor=lineConfig.color;let lineStyle=lineConfig.style;let lineWidth=lineConfig.width;let opacity=lineConfig.opacity;let pointRadius=pointConfig.radius;let pointColor=pointConfig.color;var smoothingType=lineConfig.smoothing;var getLine=function(){if(smoothingType&&smoothingType==="spline"){return d3.line().x(getX).y(getY).curve(d3.curveMonotoneX);}
return d3.line().x(getX).y(getY);};chartElements[i].line=lineGroup.append("path").datum(sumData).attr("fill","none").attr("stroke",lineColor).attr("stroke-width",lineWidth).attr("opacity",opacity).attr("stroke-dasharray",function(d){if(lineStyle==="dashed")return"5, 5";else if(lineStyle==="dotted")return"0, 5";}).attr("stroke-linecap",function(d){if(lineStyle==="dotted")return"round";}).attr("d",getLine());chartElements[i].line2=lineGroup2.append("path").datum(sumData).attr("dataset",i).attr("fill","none").attr("stroke","#ff0000").attr("stroke-width",10).attr("opacity",0).attr("d",getLine()).on("click",function(e,d){var datasetID=parseInt(d3.select(this).attr("dataset"));raiseLine(chartElements[datasetID]);me.onClick(this,datasetID,d);});if(pointRadius){chartElements[i].point=pointGroup.selectAll("points").data(sumData).enter().append("circle").attr("dataset",i).attr("fill",pointColor).attr("stroke","none").attr("cx",getX).attr("cy",getY).attr("r",pointRadius).on("click",function(e,d){var datasetID=parseInt(d3.select(this).attr("dataset"));raiseLine(chartElements[datasetID]);me.onClick(this,datasetID,d);});};if(tooltip){chartElements[i].point=pointGroup.selectAll("points").data(sumData).enter().append("circle").attr("dataset",i).attr("fill","#ff0000").attr("stroke","none").attr("opacity",0).attr("cx",getX).attr("cy",getY).attr("r",10).on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave);}
if(showLabels){var label=lineConfig.label;if(!label)label="Series "+(i+1);var line=chartElements[i].line2;chartElements[i].tag=createTag(sumData,lineColor,label,line);}};var animationSteps=bluewave.chart.utils.parseFloat(chartConfig.animationSteps);for(let i=0;i<arr.length;i++){var smoothingType=arr[i].lineConfig.smoothing;if(smoothingType&&smoothingType==="spline"){animationSteps=0;break;}}
if(!isNaN(animationSteps)&&animationSteps>50){let lines=lineGroup.selectAll("path");let points=pointGroup.selectAll("circle");let fill=fillGroup.selectAll("path");let min=d3.min(minData,d=>bluewave.chart.utils.parseFloat(d.value));let scaleY=config.scaling==="logarithmic"?y(min):y(0);var orgLines=[];lines.each(function(){orgLines.push(d3.select(this).attr("d"));});var orgFills=[];fill.each(function(){orgFills.push(d3.select(this).attr("d"));});lines.attr("d",d3.line().x(getX).y(scaleY));points.attr("cx",getX).attr("cy",scaleY);fill.attr("d",d3.area().x(getX).y0(axisHeight).y1(scaleY));lines.transition().duration(animationSteps).attr("d",function(d,i){return orgLines[i];});points.transition().duration(animationSteps).attr("cx",getX).attr("cy",getY);fill.transition().duration(animationSteps).attr("d",function(d,i){return orgFills[i];});if(showLabels){for(var i=0;i<chartElements.length;i++){var poly=chartElements[i].tag.poly;var text=chartElements[i].tag.text;var polyTransform=poly.attr("transform");var textTransform=text.attr("transform");var polyX=polyTransform.slice(10).split(",")[0];var textX=textTransform.slice(10).split(",")[0];poly.attr("transform","translate("+(polyX)+","+(axisHeight-9.6)+")");text.attr("transform","translate("+(textX)+","+(axisHeight)+")");poly.transition().duration(animationSteps).attr("transform",polyTransform);text.transition().duration(animationSteps).attr("transform",textTransform);}};};if(chartConfig.xGrid||chartConfig.yGrid){var xTicks=false;if(chartConfig.xGrid===true){xTicks=bluewave.chart.utils.parseFloat(chartConfig.xTicks);if(isNaN(xTicks))xTicks=true;}
var yTicks=false;if(chartConfig.yGrid===true){yTicks=bluewave.chart.utils.parseFloat(chartConfig.yTicks);if(isNaN(yTicks))yTicks=true;}
drawGridlines(plotArea,x,y,axisHeight,axisWidth,xTicks,yTicks);}};var sortKeys=function(xKeys,arr){var xType=getType(xKeys);var xSorts={};arr.forEach(function(d,i){var sumData=d.sumData;var sortDir="none";var asc=0;var desc=0;var unk=0;if(sumData.length<2){}
else{for(var j=0;j<sumData.length-1;j++){var currKey=sumData[j].key;var nextKey=sumData[j+1].key;if(xType=="date"){currKey=new Date(currKey).getTime();nextKey=new Date(nextKey).getTime();if(nextKey>=currKey)asc++;if(nextKey<=currKey)desc++;}
else if(xType=="number"||xType=="currency"){currKey=bluewave.chart.utils.parseFloat(currKey);nextKey=bluewave.chart.utils.parseFloat(nextKey);if(nextKey>currKey)asc++;if(nextKey<currKey)desc++;if(nextKey==currKey)unk++;}
else{var x=currKey.localeCompare(nextKey);if(x<0)asc++;if(x>0)desc++;if(x==0)unk++;}}
if(asc+unk==sumData.length-1)sortDir="asc";if(desc+unk==sumData.length-1)sortDir="desc";var sort=xSorts[sortDir];if(!sort){sort=[];xSorts[sortDir]=sort;}
sort.push(i);}});var sortKeys=Object.keys(xSorts);var xSort=sortKeys.length==1?sortKeys[0]:null;if(xType=='date')xSort="asc";if(xSort){xKeys.sort(function(a,b){if(xType=="number"||xType=="currency"){if(xSort=="asc"){return bluewave.chart.utils.parseFloat(a)-bluewave.chart.utils.parseFloat(b);}
else{return bluewave.chart.utils.parseFloat(b)-bluewave.chart.utils.parseFloat(a);}}
else if(xType=="date"){if(!(a instanceof Date))a=new Date(a);if(!(b instanceof Date))b=new Date(b);return a.getTime()-b.getTime();}
else{if(xSort=="asc"){return a.localeCompare(b);}
else{return b.localeCompare(a);}}});}};var createTag=function(dataSet,color,label,line){var lastItem=dataSet[dataSet.length-1];var lastKey=lastItem.key;var lastVal=lastItem.value;var keyType=getType(dataSet[0].key);if(keyType==="date"){var tx=x(new Date(lastKey))}else{var tx=x(lastKey)}
var ty=(config.scaling==="logarithmic")?y(lastVal+1):y(lastVal);var temp=plotArea.append("text").attr("dy",".35em").attr("text-anchor","start").text(label);var box=temp.node().getBBox();temp.remove();var w=Math.max(box.width+8,60);var h=box.height;var a=h/2;var vertices=[[0,0],[w,0],[w,h],[0,h],[-a,a]];var poly=plotArea.append("polygon").attr("points",vertices.join(" ")).attr("transform","translate("+(tx+(a))+","+(ty-(a))+")").style("fill",color).on("click",function(e,d){line.dispatch('click');});var text=plotArea.append("text").attr("transform","translate("+(tx+a+4)+","+ty+")").attr("dy",".35em").attr("text-anchor","start").style("fill","#fff").text(label).on("click",function(e,d){line.dispatch('click');});return{poly:poly,text:text};};var addColorGradient=function(lineColor,startOpacity,endOpacity,className,parent){if(startOpacity==null)startOpacity=0;if(endOpacity==null)endOpacity=0;parent.append("defs").append("linearGradient").attr("id",className).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").selectAll("stop").data([{offset:"0%",color:lineColor,opacity:startOpacity},{offset:"100%",color:lineColor,opacity:endOpacity}]).enter().append("stop").attr("offset",(d)=>d.offset).attr("stop-color",(d)=>d.color).attr("stop-opacity",(d)=>d.opacity);};var raiseLine=function(chartElements){if(!chartElements)return;chartElements.line.raise();chartElements.line2.raise();if(chartElements.point)chartElements.point.raise();var tag=chartElements.tag;if(tag){var tagParent=tag.poly.node().parentNode;var poly=tag.poly.node().cloneNode(true);var text=tag.text.node().cloneNode(true);tag.poly.remove();tag.text.remove();tagParent.appendChild(poly);tagParent.appendChild(text);chartElements.tag.poly=d3.select(poly);chartElements.tag.text=d3.select(text);}};var applySmoothing=function(smoothingType,smoothingValue,data){if(smoothingType==="movingAverage"){if(!isNaN(smoothingValue)&&smoothingValue>0){var values=data.map(d=>d.value);function movingAverage(vals,n){let arr=[vals[0]];let sum=0;for(let i=1;i<n;i++){sum+=vals[i];arr.push(sum/i);}
for(let i=n;i<vals.length;i++){let mean=d3.mean(vals.slice(i-n/2,i+n/2));arr.push(mean);}
return arr;}
let average=movingAverage(values,smoothingValue);data.forEach(function(d,i){d.value=isNaN(average[i])?0:average[i];});}}
else if(smoothingType==="kde"){var values=data.map(d=>d.value);var numValues=values.length;var extent=d3.extent(values);var minVal=extent[0];var maxVal=extent[1];var sumData=values.reduce((a,b)=>a+b,0);var spacing=(maxVal-minVal)/numValues;spacing=Math.round(spacing);var sampleData=[];for(var i=0;i<values.length;i++){for(var j=0;j<values[i];j++){sampleData.push(i+0.5);j+=spacing;}}
var density=[];var kernel=epanechnikov(smoothingValue);for(var i=0;i<values.length;i++){var val=d3.mean(sampleData,function(v){return kernel(i-v);});density.push([i,val]);}
data.forEach(function(d,i){d.value=density[i][1]*sumData;});}};var epanechnikov=function(bandwidth){return x=>Math.abs(x/=bandwidth)<=1?0.75*(1-x*x)/bandwidth:0;};var merge=javaxt.dhtml.utils.merge;var round=javaxt.dhtml.utils.round;var checkSVG=bluewave.chart.utils.checkSVG;var initChart=bluewave.chart.utils.initChart;var getType=bluewave.chart.utils.getType;var drawAxes=bluewave.chart.utils.drawAxes;var drawGridlines=bluewave.chart.utils.drawGridlines;var createKeyValueDataset=bluewave.chart.utils.createKeyValueDataset;var createTooltip=bluewave.chart.utils.createTooltip;init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.MapChart=function(parent,config){var me=this;var defaultConfig={style:{backgroundColor:"#fff"}};var svg,mapArea;var projection,scale,translate,rotate,center;var panningDisabled=false;var background;var layers=[];var extent={};var projectionType="Mercator";var init=function(){config=merge(config,defaultConfig);initChart(parent,function(s,g){svg=s;mapArea=g;svg.call(d3.zoom().scaleExtent([1,1]).on('zoom',recenter));svg.on("click",function(e){var projection=me.getProjection();if(!projection)return;var point=d3.pointer(e);var coord=projection.invert(point);me.onMouseClick(coord[1],coord[0],e);});});};this.addPoints=function(points,config){layers.push({type:"points",features:points,config:config});};this.addLines=function(lines,config){layers.push({type:"lines",features:lines,config:config});};this.addPolygons=function(polygons,config){layers.push({type:"polygons",features:polygons,config:config});};this.addLabels=function(labels,config){layers.push({type:"labels",features:labels,config:config});};this.addGrid=function(config){layers.push({type:"grid",features:null,config:config});};this.setBackgroundColor=function(color){config.style.backgroundColor=color;if(color){if(background)background.attr("fill",color);}};this.getProjection=function(){return projection;};this.setProjection=function(name){projectionType=name;projection=d3["geo"+name]();};this.getCentroid=function(feature){if(!feature)return null;if(!projection)me.setProjection("Mercator");var path=d3.geoPath(projection);if(isArray(feature)){var type="Point";if(isArray(feature[0]))type="Polygon";feature={type:"Feature",geometry:{type:type,coordinates:feature}};}
var centroid=path.centroid(feature);centroid=projection.invert(centroid);return centroid;};this.onRecenter=function(lat,lon){};this.onRedraw=function(){};this.onMouseClick=function(lat,lon,e){};this.enablePan=function(){panningDisabled=false;};this.disablePan=function(){panningDisabled=true;};this.clear=function(){clearChart();projection=scale=translate=rotate=center=null;layers=[];};var clearChart=function(){if(mapArea){mapArea.node().innerHTML="";mapArea.attr("transform",null);}};this.resize=function(){if(mapArea){}};this.setCenter=function(center,scale){var width=parent.offsetWidth;var height=parent.offsetHeight;if(!scale)scale=width/2/Math.PI;projection.rotate([-center[0],0]).center([0,center[1]]).scale(scale).translate([width/2,height/2]);};this.getMidPoint=function(coordinates,ratio,inclination){if(!projection)me.setProjection("Mercator");if(isNaN(ratio))ratio=0;if(inclination==="south"){inclination=1;}else{inclination=-1;}
var coords=coordinates.slice();coords[0]=projection(coords[0]);coords[1]=projection(coords[1]);if((coords[1][0]-coords[0][0])<0)coords.reverse();var midPointX=(coords[0][0]+coords[1][0])/2;var midPointY=(coords[0][1]+coords[1][1])/2;var deltaX=coords[1][0]-coords[0][0];var deltaY=coords[1][1]-coords[0][1];var normVector=[-deltaY*ratio*inclination,deltaX*ratio*inclination];var pseudoPoint=[(normVector[0]+midPointX),(normVector[1]+midPointY)];pseudoPoint=projection.invert(pseudoPoint);return pseudoPoint;};this.update=function(callback){clearChart();checkSVG(me,function(svg){var parent=svg.node().parentNode;update(parent);if(callback)callback();});};this.getSVG=function(){return svg;};var update=function(parent){clearChart();var width=parent.offsetWidth;var height=parent.offsetHeight;var centerLat=parseFloat(config.lat);var centerLon=parseFloat(config.lon);if(isNaN(centerLat))centerLat=0;if(isNaN(centerLon))centerLon=0;if(!projection)me.setProjection("Mercator");if(projectionType==="AlbersUsa"){projection.translate([width/2,height/2]);draw();return;}
projection.scale(width/2/Math.PI).rotate([-centerLon,0]).center([0,centerLat]).translate([width/2,height/2]);scale=projection.scale();translate=projection.translate();rotate=projection.rotate();center=projection.center();setExtent(extent);draw();};var recenter=function(e){var projection=me.getProjection();if(!projection||panningDisabled)return;var rect=javaxt.dhtml.utils.getRect(svg.node());var w=rect.width;var h=rect.height;var t=e.transform;var x=(w/2)-t.x;var y=(h/2)-t.y;var p=projection.invert([x,y]);var getLat=d3.scaleLinear().domain([0,h]).range([0,180]);var getLon=d3.scaleLinear().domain([0,w]).range([0,360]);var tx=translate[0]-t.invertX(translate[0]);var ty=translate[1]-t.invertY(translate[1]);var lat=(getLat(ty)/2)+center[1];var lon=getLon(tx)+rotate[0];projection.rotate([lon,rotate[1],rotate[2]]);projection.center([0,lat]);draw();me.onRecenter(p[1],p[0]);};this.getExtent=function(){var projection=me.getProjection();if(!projection)return;var rect=javaxt.dhtml.utils.getRect(svg.node());var w=rect.width;var h=rect.height;var ul=projection.invert([0,0]);var lr=projection.invert([w,h]);return{left:ul[0],right:lr[0],top:ul[1],bottom:lr[1]};};this.setExtent=function(upperLeft,lowerRight,callback){extent.upperLeft=upperLeft;extent.lowerRight=lowerRight;if(!projection){me.update(function(){setExtent(extent);if(callback)callback();});}
else{setExtent(extent);if(callback)callback();}};var setExtent=function(extent,base=10){if(base<0||isNaN(base))return;if(!projection)return;if(projectionType==="AlbersUsa")return;if(!extent.upperLeft||!extent.lowerRight)return;var upperLeft=extent.upperLeft;var lowerRight=extent.lowerRight;var scale=projection.scale();var windowExtent=me.getExtent();var rect=javaxt.dhtml.utils.getRect(svg.node());var w=rect.width;var h=rect.height;if(projectionType=="Albers"){projection.parallels([lowerRight[1]+Math.abs(lowerRight[1]*(1/6)),upperLeft[1]-Math.abs(upperLeft[1]*(1/6))]);}
var initialUpperLeft=projection([windowExtent.left,windowExtent.top]);var initialLowerRight=projection([windowExtent.right,windowExtent.bottom]);var extentLongDiff=Math.abs(initialUpperLeft[0]-initialLowerRight[0]);var extentLatDiff=Math.abs(initialUpperLeft[1]-initialLowerRight[1]);if(projection(upperLeft)[0]>projection(lowerRight)[0]){projection.rotate([-upperLeft[0]-180,0]);}
var ulCartesian=projection(upperLeft);var lrCartesian=projection(lowerRight);var longitudeDiff=Math.abs(ulCartesian[0]-lrCartesian[0]);var scaleRatio;scaleRatio=longitudeDiff/extentLongDiff;projection.scale(scale/scaleRatio);ulCartesian=projection(upperLeft);lrCartesian=projection(lowerRight);var centerCartesian=[ulCartesian[0]+w/2,ulCartesian[1]+h/2];var center=projection.invert(centerCartesian);projection.rotate([-center[0],0]).center([0,center[1]]);center=me.getMidPoint([upperLeft,lowerRight]);var extentCheck=me.getExtent();var latitudeDiff=Math.abs(lowerRight[1]-extentCheck.bottom);if(lowerRight[1]<extentCheck.bottom){let windowExtent=extentCheck.top-extentCheck.bottom;let scaleRatio=latitudeDiff/windowExtent;scaleRatio++;let scale=projection.scale();projection.scale(scale/scaleRatio)};projection.rotate([-center[0],0]).center([0,center[1]]);setExtent(extent,--base);};var draw=function(){clearChart();var backgroundGroup=mapArea.append("g");backgroundGroup.attr("name","background");background=backgroundGroup.append("rect").attr("width","100%").attr("height","100%");if(config.style.backgroundColor){background.attr("fill",config.style.backgroundColor);}
var layerGroup=mapArea.append("g");layerGroup.attr("name","layers");var path=d3.geoPath(projection);layers.forEach(function(layer,i){if(!layer.config)layer.config={};var name=layer.config.name;if(!name)name="layer"+i;var g=layerGroup.append("g");g.attr("name",name);if(layer.type==="points"){renderPointLayer(layer,g,path);}
else if(layer.type==="lines"){renderLineLayer(layer,g,path);}
if(layer.type==="polygons"){renderPolygonLayer(layer,g,path);}
else if(layer.type==="labels"){renderLabelLayer(layer,g,path);}
else if(layer.type==="grid"){renderGridLayer(layer,g,path);}});};var renderPointLayer=function(layer,g,path){if(!layer.config)layer.config={};var config=layer.config;var style=layer.config.style;if(!style)style={};var tooltip;if(config.showTooltip===true)tooltip=createTooltip();var highlight=false;if(tooltip||config.onClick)highlight=true;var color=style.fill;if(!color)color="red";var opacity=style.opacity;if(!opacity)opacity=1.0;var radius=parseInt(style.radius);if(isNaN(radius))radius=3;if(radius<0)radius=1;var outlineWidth=parseFloat(style.outlineWidth);if(isNaN(outlineWidth))outlineWidth=1;var outlineColor=style.outlineColor;var points=g.selectAll("*").data(layer.features).enter().append("circle").attr('r',function(d){if(typeof style.radius==='function'){return style.radius(d);}
else return radius;}).attr("transform",function(d){var coords=getCoordinates(d);if(coords)coords=projection(coords);return coords?"translate("+coords+")":"";}).attr("opacity",opacity).style("fill",color).attr("stroke",outlineColor).attr("stroke-width",outlineWidth).attr("stroke-opacity",opacity).on("click",function(e,feature,idx,siblings){if(config.onClick){config.onClick.apply(me,[{feature:feature,element:siblings[idx],layer:layer,event:e}]);}});layer.elements=points;};var renderLineLayer=function(layer,g,path){if(!layer.config)layer.config={};var style=layer.config.style;if(!style)style={};var width=parseInt(style.width);if(isNaN(width))width=1;var lineStyle=style.lineStyle;if(!lineStyle)lineStyle="solid";var smoothing=style.smoothing;if(!smoothing||smoothing==="none")smoothing="curveLinear";var color=style.color;if(!color)color="red";var opacity=style.opacity;if(!opacity)opacity=1.0;var lines=g.selectAll("*").data(layer.features).enter().append("path").attr("d",function(d){var curve=d3.line().curve(d3[smoothing]);var arr=d.map(coord=>projection(coord));return curve(arr);}).attr("fill","none").attr("opacity",opacity).style("stroke",color).style("stroke-width",width).attr("stroke-dasharray",function(d){if(lineStyle==="dashed")return"10, 10";else if(lineStyle==="dotted")return"0, 10";}).attr("stroke-linecap",function(d){if(lineStyle==="dotted")return"round";});layer.elements=lines;};var renderGridLayer=function(layer,g,path){if(!layer.config)layer.config={};var style=layer.config.style;if(!style)style={};var width=parseInt(style.width);if(isNaN(width))width=0.5;var lineStyle=style.lineStyle;if(!lineStyle)lineStyle="solid";var color=style.color;if(!color)color="gray";var opacity=style.opacity;if(!opacity)opacity=0.5;var longSteps=style.longSteps;if(!longSteps)longSteps=10;var latSteps=style.latSteps;if(!latSteps)latSteps=10;var graticule=d3.geoGraticule().step([longSteps,latSteps]);var lines=g.selectAll("*").data([graticule()]).enter().append("path").attr("d",path).attr("fill","none").attr("opacity",opacity).style("stroke",color).style("stroke-width",width).attr("stroke-dasharray",function(d){if(lineStyle==="dashed")return"10, 10";else if(lineStyle==="dotted")return"0, 10";}).attr("stroke-linecap",function(d){if(lineStyle==="dotted")return"round";});layer.elements=lines;};var renderPolygonLayer=function(layer,g,path){if(!layer.config)layer.config={};var config=layer.config;var style=layer.config.style;if(!style)style={};var tooltip,getTooltipLabel;if(config.showTooltip===true){getTooltipLabel=config.getTooltipLabel;if(getTooltipLabel){tooltip=createTooltip();}}
var highlight=false;if(tooltip||config.onClick)highlight=true;var mouseover=function(e,feature){if(tooltip){var label=getTooltipLabel(feature);tooltip.html(label).show();}
var el=d3.select(this);if(highlight){el.transition().duration(100);el.attr("opacity","0.8");}
if(config.onMouseOver)config.onMouseOver.apply(me,[{feature:feature,element:el,layer:layer}]);};var mousemove=function(e){if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(e,feature){if(tooltip)tooltip.style("opacity",0).style("display","none");var el=d3.select(this);if(highlight){el.transition().duration(100);el.attr("opacity","1");}
if(config.onMouseLeave)config.onMouseLeave.apply(me,[{feature:feature,element:el,layer:layer}]);};var fill=style.fill;if(!fill)fill="#DEDDE0";var stroke=style.stroke;if(!stroke)stroke="#fff";var polygons=g.selectAll("*").data(layer.features).enter().append("path").attr('d',path).attr('fill',function(d){if(typeof style.fill==='function'){return style.fill(d);}
else return fill;}).attr('stroke',stroke).style("stroke-width",0.4).on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave).on("click",function(e,feature,idx,siblings){if(config.onClick){config.onClick.apply(me,[{feature:feature,element:siblings[idx],layer:layer,event:e}]);}});layer.elements=polygons;};var renderLabelLayer=function(layer,g,path){if(!layer.config)layer.config={};var config=layer.config;var style=layer.config.style;if(!style)style={};var fontSize=parseFloat(style.fontSize);if(isNaN(fontSize))fontSize=12;var color=style.color;if(!color)color=style.fill;if(!color)color="#000";var textAlign=style.textAlign;if(!textAlign)textAlign="left";var labels=g.selectAll("text").data(layer.features).enter().append("text").attr("transform",function(d){var coords=getCoordinates(d);if(coords){coords=projection(coords);var x=coords[0];var y=coords[1];if(isNaN(x)||isNaN(y))return"";else return`translate(  ${x}, ${y}  )`;}
return"";}).attr("font-size",fontSize).attr("text-anchor",()=>{if(textAlign=="center")return"middle";return textAlign;}).style("fill",color).text((d)=>{if(d.properties&&layer.config.label){return d.properties[layer.config.label];}
else{return"";}}).on("click",function(feature,idx,siblings){if(config.onClick)config.onClick.apply(me,[{feature:feature,element:siblings[idx],layer:layer}]);});layer.elements=labels;};var getCoordinates=function(d){if(isArray(d)){return d;}
else{if(d.geometry){return d.geometry.coordinates;}}
return null;};var merge=javaxt.dhtml.utils.merge;var isArray=bluewave.chart.utils.isArray;var checkSVG=bluewave.chart.utils.checkSVG;var initChart=bluewave.chart.utils.initChart;var createTooltip=bluewave.chart.utils.createTooltip;init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.PieChart=function(parent,config){var me=this;var defaultConfig={pieKey:"key",pieValue:"value",pieCutout:0.0,pieSort:false,pieSortDir:"ascending",maximumSlices:null,showLabels:true,labelOffset:100,showTooltip:false,tooltipClass:"tooltip",showSum:false,lineColor:"#777",borderColor:"#777",extendLines:false,colors:["#6699cc","#f8f8f8"],otherColor:"#b8b8b8",animationSteps:1500};var svg,pieArea;var numSlices;var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;pieArea=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);};this.getTooltipLabel=function(d,i){return me.getKeyLabel(d.key,d)+"<br/>"+me.getValueLabel(d.value);};this.getKeyLabel=function(key,data){return key;};this.getValueLabel=function(value,data){var val=bluewave.chart.utils.parseFloat(value);if(isNaN(val))return value;return round(val,2);};this.getCenterLabel=function(pieData){var sum=0;pieData.forEach((d)=>{sum+=d.value;});var units="";if(sum>=1000){sum=Math.round(sum/1000);units="k";if(sum>=1000){sum=Math.round(sum/1000);units="M";if(sum>=1000){sum=Math.round(sum/1000);units="B";}
if(sum>=1000){sum=Math.round(sum/1000);units="T";}}}
return sum+units;};this.getNumSlices=function(){return numSlices;};this.clear=function(){clearChart();numSlices=0;};this.update=function(data,key,value){clearChart();if(arguments.length>0){if(arguments.length===1){}
else{if(typeof key==="string"){config.pieKey=key;config.pieValue=value;}
else{me.setConfig(arguments[0]);data=arguments[1];}}}
checkSVG(me,function(){update(data);});};this.getSVG=function(){return svg;};var clearChart=function(){if(pieArea){pieArea.node().innerHTML="";pieArea.attr("transform",null);}};var update=function(data){if(isArray(data)&&isArray(data[0]))data=data[0];if(!config.pieKey||!config.pieValue)return;var pieData=createKeyValueDataset(data,config.pieKey,config.pieValue);var pieSort=(config.pieSort+"").toLowerCase();var sortDir=(config.pieSortDir+"").toLowerCase();var maxSlices=parseFloat(config.maximumSlices);if(pieSort==="key"){pieData.sort(function(a,b){return sort(a.key,b.key,sortDir);});}
else if(pieSort==="value"){pieData.sort(function(a,b){return sort(a.value,b.value,sortDir);});}
else{maxSlices=null;}
numSlices=pieData.length;var hasOther=false;if(!isNaN(maxSlices)&&maxSlices>0){if(maxSlices<numSlices){var otherSlices;if(sortDir==="descending"){otherSlices=pieData.slice(maxSlices);pieData=pieData.slice(0,maxSlices);}
else{otherSlices=pieData.slice(0,numSlices-maxSlices);pieData=pieData.slice(numSlices-maxSlices,numSlices);}
if(config.showOther===true){var otherSlicesValue=0;otherSlices.forEach(function(d){var val=d.value;if(!isNaN(val))otherSlicesValue+=val;});pieData.push({key:"Other",value:otherSlicesValue});hasOther=true;}
numSlices=pieData.length;}}
var padding=0;if(typeof config.piePadding!=="undefined"){padding=config.piePadding*Math.PI/180;}
var pie=d3.pie().value(function(d){return d.value;}).sort(null).padAngle(padding);pieData=pie(pieData);var rect=javaxt.dhtml.utils.getRect(svg.node());var width=rect.width;var height=rect.height;var pieChart=pieArea.append("g");pieChart.attr("transform","translate("+width/2+","+height/2+")");var radius=Math.min(width,height)/2;var cutout=parseFloat(config.pieCutout);if(isNaN(cutout))cutout=0.65;var innerRadius=radius*cutout;var animationSteps=parseInt(config.animationSteps+"");var animationRunning;if(!isNaN(animationSteps)&&animationSteps>50){animationRunning=true;}
else{animationSteps=0;animationRunning=false;}
var tooltip;if(config.showTooltip===true){tooltip=createTooltip(config.tooltipClass);}
var mouseover=function(e,d){if(animationRunning)return;if(tooltip){var label=me.getTooltipLabel(d.data);tooltip.html(label).show();}
d3.select(this).transition().duration(100).attr("opacity","0.8");};var mousemove=function(e){if(animationRunning)return;if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(){if(animationRunning)return;if(tooltip)tooltip.hide();d3.select(this).transition().duration(100).attr("opacity","1");};var colors=config.colors;var numColors=hasOther?numSlices-1:numSlices;if(numColors>config.colors.length){colors=getColorRange(numColors,colors);}
if(hasOther)colors.push(config.otherColor);var arc=d3.arc().innerRadius(innerRadius).outerRadius(radius);var pieGroup=pieChart.append("g");pieGroup.attr("name","pie");pieGroup.selectAll("*").data(pieData).enter().append("path").attr("d",arc).attr("fill",function(d,i){return colors[i];}).attr("stroke",config.borderColor).style("stroke-width","1px").on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave);var showSum=config.showSum===true?true:false;if(showSum&&cutout>0){var text=me.getCenterLabel(pieData);if(text){var label=pieChart.append("text").attr("text-anchor","middle").attr('font-size','4em').attr('y',20);label.text(text);}}
var showLabels=config.showLabels===true?true:false;var labelGroup;if(showLabels&&pieData[0].data.key!=="undefined"&&!isNaN(pieData[0].value)){labelGroup=pieChart.append("g");labelGroup.attr("name","labels");var labelOffset=parseFloat(config.labelOffset);if(isNaN(labelOffset)||labelOffset<0)labelOffset=100;var labelEnd=0;if(labelOffset>100){labelEnd=radius*(labelOffset/100);}
else{var w=radius-innerRadius;labelEnd=innerRadius+w*(labelOffset/100);}
var extendLines=config.extendLines===true?true:false;if(extendLines&&labelOffset<=110)extendLines=false;var firstArc=d3.arc().innerRadius(innerRadius).outerRadius(innerRadius+(radius-innerRadius)*90/50);var secondArc=d3.arc().innerRadius(radius).outerRadius(radius+((labelEnd-radius)*2));var labelPadding=parseFloat(config.labelPadding+"");if(isNaN(labelPadding))labelPadding=5;var thirdArc=d3.arc().innerRadius(radius).outerRadius(radius+((labelEnd-radius)*2)+labelPadding);var debug=false;if(debug){var testGroup=pieChart.append("g").attr("name","test");testGroup.selectAll("*").data([{startAngle:0,endAngle:360*Math.PI/180}]).enter().append("path").attr("d",d3.arc().innerRadius(innerRadius).outerRadius(labelEnd)).attr("fill","none").attr("stroke","#ff0000").attr("stroke-width",1);}
let endPoints=[];var lineGroup=pieChart.append("g");lineGroup.attr("name","lines");lineGroup.selectAll("*").data(pieData).enter().append("polyline").attr("opacity","0").attr("stroke",config.lineColor).style("fill","none").attr("stroke-width",0.7).attr("points",function(d){var a=firstArc.centroid(d);var b=secondArc.centroid(d);var line=[a,b];var midangle=d.startAngle+(d.endAngle-d.startAngle)/2;var isRight=(midangle<Math.PI?true:false);if(extendLines){var x=labelEnd*(isRight?1:-1);var y=b[1];line.push([x,y]);endPoints.push([x+(isRight?labelPadding:-labelPadding),y]);}
else{var c=thirdArc.centroid(d);var l=[a,c];endPoints.push(l[l.length-1]);}
return line;});if(labelOffset>110){lineGroup.selectAll("polyline").attr("opacity","1");}
labelGroup.selectAll("*").data(pieData).enter().append("text").attr("class","label").text(function(d){return me.getKeyLabel(d.data.key,d.data);}).attr("transform",function(d,i){return"translate("+endPoints[i]+")";}).style("text-anchor",function(d,i){if(i==numSlices-1&&!extendLines){return"middle";}
else{var midangle=d.startAngle+(d.endAngle-d.startAngle)/2;return midangle<Math.PI?"start":"end";}});var box=getMinMax(pieArea);box.width=(box.maxX-box.minX)*1.1;box.height=(box.maxY-box.minY)*1.1;if(box.width>width||box.height>height){var scale,x,y;var widthDiff=box.width-width;var heightDiff=box.height-height;if(widthDiff>heightDiff){scale=width/box.width;if(scale>1){scale=1+(1-scale);}
x=width/2;y=height/2;}
else if(heightDiff>widthDiff){scale=height/box.height;x=width/2;y=(box.height);}
var orgTextHeight=0;labelGroup.selectAll("text").each(function(d,i){if(i===0){var box=javaxt.dhtml.utils.getRect(this);orgTextHeight=box.height;}});pieChart.attr("transform","translate("+x+","+y+") "+"scale("+scale+")");var currTextHeight=0;labelGroup.selectAll("text").each(function(d,i){if(i===0){var box=javaxt.dhtml.utils.getRect(this);currTextHeight=box.height;}});if(currTextHeight<orgTextHeight){var labelScale=orgTextHeight/currTextHeight;labelGroup.selectAll("text").each(function(d,i){var translate=this.getAttribute('transform');this.setAttribute('transform',translate+" scale("+labelScale+")");});}
var y=rect.y;var x=rect.x;var cx=rect.x+(rect.width/2);var cy=rect.y+(rect.height/2);var rect=javaxt.dhtml.utils.getRect(pieChart.node());var dy=(height-rect.height)/2;var dx=(width-rect.width)/2;var x2=rect.x+(rect.width/2);var y2=rect.y+(rect.height/2);var dx=cx-x2;var dy=cy-y2;if(dy<0){dy=0;}
if(dx<0){dx=0;}
pieChart.attr("transform","translate("+((width/2)+dx)+","+((height/2)+dy)+") "+"scale("+scale+")");}};if(animationSteps){var totalDelay=0;animationSteps/=2;var arcs=pieGroup.selectAll("path");var zeroaArc=d3.arc().innerRadius(0).outerRadius(0);arcs.attr("d",zeroaArc);arcs.transition().delay(function(d,i){var angleDiff=Math.abs(d.startAngle-d.endAngle)+(d.padAngle);var angleRatio=angleDiff/(2*Math.PI);var thisDelay=totalDelay;var nextDelay=angleRatio*animationSteps;totalDelay+=nextDelay;return thisDelay;}).duration(function(d){var angleDiff=Math.abs(d.startAngle-d.endAngle)+(d.padAngle);var angleRatio=angleDiff/(2*Math.PI);return angleRatio*animationSteps;}).ease(d3.easeLinear).attrTween('d',function(d){var interpolater=d3.interpolate(d.startAngle,d.endAngle);return function(t){d.endAngle=interpolater(t);return arc(d);};});if(showLabels){var labels=labelGroup.selectAll("text");var polylines=lineGroup.selectAll("polyline");polylines.attr("opacity",0);labels.attr("opacity",0);var delayTransition=function(d,i){return i*animationSteps/numSlices;};if(labelOffset>110){polylines.transition().delay(delayTransition).duration(animationSteps).attr("opacity",1);}
labels.transition().delay(delayTransition).duration(animationSteps).attr("opacity",1);}
setTimeout(()=>{animationRunning=false;},totalDelay);};};var sort=function(x,y,sortDir){var compareStrings=(typeof x==="string"&&typeof y==="string");sortDir=(sortDir+"").toLowerCase();if(sortDir==="descending"){if(compareStrings)return y.localeCompare(x);else return y-x;}
else{if(compareStrings)return x.localeCompare(y);else return x-y;}};var getMinMax=function(g){var minX=Number.MAX_VALUE;var maxX=0;var minY=Number.MAX_VALUE;var maxY=0;g.selectAll("*").each(function(){var rect=javaxt.dhtml.utils.getRect(d3.select(this).node());minX=Math.min(rect.left,minX);maxX=Math.max(rect.right,maxX);minY=Math.min(rect.top,minY);maxY=Math.max(rect.bottom,maxY);});return{minX:minX,maxX:maxX,minY:minY,maxY:maxY};};var merge=javaxt.dhtml.utils.merge;var checkSVG=bluewave.chart.utils.checkSVG;var isArray=bluewave.chart.utils.isArray;var initChart=bluewave.chart.utils.initChart;var getColorRange=bluewave.chart.utils.getColorRange;var createTooltip=bluewave.chart.utils.createTooltip;var createKeyValueDataset=bluewave.chart.utils.createKeyValueDataset;var round=javaxt.dhtml.utils.round;init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.SankeyChart=function(parent,config){var me=this;var defaultConfig={margin:{top:10,right:10,bottom:10,left:10},links:{color:"#ccc",opacity:0.3}};var svg,chart,sankeyArea;var nodes=[];var links=[];var getColor=d3.scaleOrdinal(d3.schemeCategory10);var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;chart=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);};this.getChart=function(){return sankeyArea;};this.getNodeColor=function(d){return getColor(d.name.replace(/ .*/,""));};this.getNodeLabel=function(d){return d.name;};this.addNode=function(name,group){if(!name)return;var node;if(name.name)node=name;else node={name:name,group:group};nodes.push(node);return node;};this.addLink=function(source,target,value){if(!source||!target)return;if(source.name)source=source.name;if(target.name)target=target.name;var link={source:source,target:target,value:value};links.push(link);return link;};this.clear=function(){clearChart();nodes=[];links=[];};this.update=function(chartConfig,data){me.setConfig(chartConfig);if(data){me.clear();if(data.nodes){nodes=data.nodes;}
if(data.links){links=data.links;}}
checkSVG(me,function(){var parent=svg.node().parentNode;renderChart(parent);});};this.getSVG=function(){return svg;};var clearChart=function(){if(chart)chart.selectAll("*").remove();};var renderChart=function(parent){clearChart();var width=parent.offsetWidth;var height=parent.offsetHeight;sankeyArea=chart.append("g");sankeyArea.attr("name","sankey").attr("width",width).attr("height",height);var sankey=d3.sankey().nodeId((d)=>d.name).nodeWidth(20).nodePadding(20).iterations([6]).size([width,height]);let graph=sankey({nodes:nodes,links:links});var size=sankey.size();var width=size[0];var formatNumber=d3.format(",.0f");var getLinkColor=function(d,opacity){var linkColor;if(config.links.color==="source"){linkColor=d.source.color;}
else{linkColor=config.links.color;}
return mixColors(linkColor,"white",1-opacity);};var linkGroup=sankeyArea.append("g");linkGroup.attr("name","links");var link=linkGroup.selectAll("*").data(graph.links).enter().append("path").attr("class","sankey-link").attr("d",d3.sankeyLinkHorizontal()).attr("stroke-width",function(d){return Math.max(d.width,1);}).on('mouseover',function(e,d){var opacity=Math.min(1,config.links.opacity*1.3);var linkColor=getLinkColor(d,opacity);d3.select(this).style("stroke",linkColor);}).on('mouseout',function(e,d){var linkColor=getLinkColor(d,config.links.opacity);d3.select(this).style("stroke",linkColor);});var nodeGroup=sankeyArea.append("g");nodeGroup.attr("name","nodes");var node=nodeGroup.selectAll("*").data(graph.nodes).enter().append("g").attr("class","sankey-node");node.append("rect").attr("x",function(d){return d.x0;}).attr("y",function(d){return d.y0;}).attr("height",function(d){return Math.max(d.y1-d.y0,1);}).attr("width",sankey.nodeWidth()).style("fill",function(d){return(d.color=me.getNodeColor(d));}).style("stroke",function(d){return d3.rgb(d.color).darker(2);}).append("title").text(function(d){return d.name+"\n"+formatNumber(d.value);});link.each(function(){var path=d3.select(this);path.style("stroke",function(d){return getLinkColor(d,config.links.opacity);});});link.append("title").text(function(d){return d.source.name+" → "+d.target.name+"\n"+formatNumber(d.value);});node.append("text").attr("x",function(d){return d.x0-6;}).attr("y",function(d){return(d.y1+d.y0)/2;}).attr("dy","0.35em").attr("text-anchor","end").text(function(d){return me.getNodeLabel(d);}).filter(function(d){return d.x0<width/2;}).attr("x",function(d){return d.x1+6;}).attr("text-anchor","start");};var merge=javaxt.dhtml.utils.merge;var checkSVG=bluewave.chart.utils.checkSVG;var initChart=bluewave.chart.utils.initChart;var mixColors=bluewave.chart.utils.mixColors;init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.ScatterChart=function(parent,config){var me=this;var defaultConfig={pointColor:"#6699cc",pointRadius:7,pointOpacity:0.8,pointLabels:false,showRegLine:false,showTooltip:false};var svg,chart,plotArea,line;var x,y;var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;chart=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);};this.clear=function(){if(chart)chart.selectAll("*").remove();};this.update=function(data,xKey,yKey){me.clear();if(arguments.length>0){if(arguments.length===1){}
else{if(typeof xKey==="string"){config.xAxis=xKey;config.yAxis=yKey;}
else{me.setConfig(arguments[0]);data=arguments[1];}}}
checkSVG(me,function(){renderChart(data);});};this.getSVG=function(){return svg;};this.getPointLabel=function(d){return"";};this.getPointRadius=function(d){return config.pointRadius;};this.getPointColor=function(d){return config.pointColor;};this.getPointOpacity=function(d){return config.pointOpacity;};this.getTooltipLabel=function(d){return config.xAxis+": "+d[config.xAxis]+"<br/>"+config.yAxis+": "+d[config.yAxis];};this.onClick=function(el,datasetID,d){};var renderChart=function(data){var rect=javaxt.dhtml.utils.getRect(svg.node());var width=rect.width;var height=rect.height;var axisHeight=height;var axisWidth=width;plotArea=chart.append("g");plotArea.attr("width",width).attr("height",height);let xKey=config.xAxis;let yKey=config.yAxis;if(!xKey||!yKey)return;if(isArray(data)&&isArray(data[0]))data=data[0];if(data.length==0)return;var axes=drawAxes(plotArea,axisWidth,axisHeight,xKey,yKey,data,null,config);x=axes.x;y=axes.y;var margin=axes.margin;if(margin){var marginLeft=margin.left;var marginRight=margin.right;var marginTop=margin.top;var marginBottom=margin.bottom;var maxLabelWidth=0;if(config.pointLabels){var temp=plotArea.append("g");temp.selectAll("text").data(data).enter().append("text").attr("x",0).attr("y",0).attr("text-anchor","start").attr("font-size",10).text(function(d){return me.getPointLabel(d);});var box=temp.node().getBBox();temp.remove();maxLabelWidth=Math.max(box.width,maxLabelWidth);}
if(marginTop>0||marginBottom>0||marginLeft>0||marginRight>0){axisHeight-=(marginTop+marginBottom);axisWidth-=(marginLeft+marginRight);plotArea.selectAll("*").remove();plotArea.attr("transform","translate("+marginLeft+","+marginTop+")");axes=drawAxes(plotArea,axisWidth,axisHeight,xKey,yKey,data,null,config);}
margin={top:marginTop,right:marginRight,bottom:marginBottom,left:marginLeft};}
x=axes.x;y=axes.y;let xType=getType(data[xKey]);if(config.pointLabels){let scalingFactor=maxLabelWidth/axisWidth;x=extendScale({scale:axes.x,band:axes.xBand},[0,axisWidth],scalingFactor).scale;reDrawAxes(plotArea,axes.xAxis,x,null,null,axisHeight);}
if(config.xGrid||config.yGrid){drawGridlines(plotArea,x,y,axisHeight,axisWidth,config.xGrid,config.yGrid);}
var getX=function(d){if(xType==="date"){return x(new Date(d[xKey]));}
else{return x(d[xKey]);}};var getY=function(d){return y(d[yKey]);};var tooltip;if(config.showTooltip===true){tooltip=createTooltip();}
var mouseover=function(e,d){if(tooltip){var label=me.getTooltipLabel(d);tooltip.html(label).show();}
d3.select(this).transition().duration(100).attr("opacity","0.8");};var mousemove=function(e){if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(){if(tooltip)tooltip.hide();d3.select(this).transition().duration(100).attr("opacity","1");};var pointGroup=plotArea.append("g");pointGroup.attr("name","points");pointGroup.selectAll("*").data(data).enter().append("circle").attr("dataset",0).attr("cx",getX).attr("cy",getY).attr("r",function(d){return me.getPointRadius(d);}).style("fill",function(d){return me.getPointColor(d);}).style("opacity",function(d){return me.getPointOpacity(d);}).style("stroke","white").on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave).on("click",function(e,d){var datasetID=parseInt(d3.select(this).attr("dataset"));me.onClick(this,datasetID,d);});if(config.pointLabels===true){var labelGroup=plotArea.append("g");labelGroup.attr("name","labels");labelGroup.append("g").selectAll("text").data(data).enter().append("text").attr("x",function(d){var cx=getX(d);var r=me.getPointRadius(d);return cx+r+1;}).attr("y",getY).attr("font-size",10).text(function(d){return me.getPointLabel(d);}).on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave).on("click",function(node){});}
if(config.showRegLine){var linReg=calculateLinReg(data,xKey,yKey,d3.min(data,function(d){return d[xKey]}),d3.min(data,function(d){return d[yKey]}),x,y);line=d3.line().x(function(d){return(d[0])}).y(function(d){return(d[1])});plotArea.append("path").datum(linReg).attr("dataset",0).attr("d",line).attr("stroke",me.getPointColor()).attr("stroke-linecap",'round').attr("stroke-width",2).on("click",function(e,d){var datasetID=parseInt(d3.select(this).attr("dataset"));me.onClick(this,datasetID,d);});}
var box=getMinMax(plotArea);box.width=(box.maxX-box.minX)*1.1;box.height=(box.maxY-box.minY)*1.1;if(box.width>width||box.height>height){var scale;var widthDiff=box.width-width;var heightDiff=box.height-height;if(widthDiff>heightDiff){scale=width/box.width;if(scale>1){scale=1+(1-scale);}}
else if(heightDiff>widthDiff){scale=height/box.height;}
marginTop=(marginTop+(heightDiff/2))*scale;plotArea.attr("transform","translate("+marginLeft+","+marginTop+") "+"scale("+scale+")");}};var calculateLinReg=function(data,xKey,yKey,minX,minY,xScale,yScale){var n=data.length;var pts=[];var xAxisData=[];var yAxisData=[];data.forEach((val)=>{var obj={};obj.x=parseFloat(xScale(val[xKey]));obj.y=parseFloat(yScale(val[yKey]));obj.mult=obj.x*obj.y;pts.push(obj);xAxisData.push(parseFloat(xScale(val[xKey])));yAxisData.push(parseFloat(yScale(val[yKey])));});var sum_x=0;var sum_y=0;var sum_xy=0;var sum_xx=0;var count=0;var x=0;var y=0;var valuesLength=xAxisData.length;if(valuesLength!=yAxisData.length){throw new Error('The values in xAxis and yAxis need to have same size!');}
if(valuesLength===0){return[[],[]];}
for(var v=0;v<valuesLength;v++){x=xAxisData[v];y=yAxisData[v];sum_x+=x;sum_y+=y;sum_xx+=x*x;sum_xy+=x*y;count++;}
var m=(count*sum_xy-sum_x*sum_y)/(count*sum_xx-sum_x*sum_x);var b=(sum_y/count)-(m*sum_x)/count;var finalResults=[];for(var v=0;v<valuesLength;v++){x=xAxisData[v];y=x*m+b;finalResults.push([x,y]);}
return finalResults;};var getMinMax=function(g){var minX=Number.MAX_VALUE;var maxX=0;var minY=Number.MAX_VALUE;var maxY=0;g.selectAll("*").each(function(){var rect=javaxt.dhtml.utils.getRect(d3.select(this).node());minX=Math.min(rect.left,minX);maxX=Math.max(rect.right,maxX);minY=Math.min(rect.top,minY);maxY=Math.max(rect.bottom,maxY);});return{minX:minX,maxX:maxX,minY:minY,maxY:maxY};};var merge=javaxt.dhtml.utils.merge;var onRender=bluewave.chart.utils.onRender;var isArray=bluewave.chart.utils.isArray;var checkSVG=bluewave.chart.utils.checkSVG;var initChart=bluewave.chart.utils.initChart;var getType=bluewave.chart.utils.getType;var getScale=bluewave.chart.utils.getScale;var drawAxes=bluewave.chart.utils.drawAxes;var drawLabels=bluewave.chart.utils.drawLabels;var drawGridlines=bluewave.chart.utils.drawGridlines;var extendScale=bluewave.chart.utils.extendScale;var reDrawAxes=bluewave.chart.utils.reDrawAxes;var createTooltip=bluewave.chart.utils.createTooltip;init();};
if(!bluewave)var bluewave={};if(!bluewave.charts)bluewave.charts={};bluewave.charts.TreeMapChart=function(parent,config){var me=this;var defaultConfig={key:"name",value:"value",shape:"square",groupBy:null,colors:d3.schemeCategory10,keyLabel:true,valueLabel:true,groupLabel:true,showTooltip:false,style:{keyLabel:{"font-size":"14px","color":"#fff"},valueLabel:{"font-size":"11px","color":"#fff"},groupLabel:{"font-size":"16px"}}};var svg,plotArea;var tooltip;var getColor;var cells;var init=function(){me.setConfig(config);initChart(parent,function(s,g){svg=s;plotArea=g;});};this.setConfig=function(chartConfig){if(!chartConfig)config=defaultConfig;else config=merge(chartConfig,defaultConfig);if(config.showTooltip===true){tooltip=createTooltip();}
else{tooltip=false;}};this.getTooltipLabel=function(d,i){var label=d.name;if(d.group){if(d.group.length>0)label+=" ("+d.group+")";}
return label+"<br/>"+me.getValueLabel(d.value);};this.getKeyLabel=function(key,data){return key;};this.getValueLabel=function(value,data){var val=bluewave.chart.utils.parseFloat(value);if(isNaN(val))return value;return round(val,2);};this.onClick=function(cell,data){};this.onDblClick=function(cell,data){};this.clear=function(){if(plotArea)plotArea.selectAll("*").remove();cells=null;};this.update=function(chartConfig,data,callback){me.clear();if(arguments.length>1){me.setConfig(chartConfig);}
else{data=arguments[0];}
checkSVG(me,function(){renderChart(data);if(callback)callback();});};this.getSVG=function(){return svg;};this.getGroup=function(groupName){var arr=[];if(cells){cells.each(function(n){if(n.data.group===groupName){var cell=d3.select(this).node();arr.push({cell:cell,rect:cell,data:n.data});}});}
return arr;};this.getGroups=function(){var groups={};if(cells){cells.each(function(n){var groupName=n.data.group;groups[groupName]=[];});}
for(var groupName in groups){if(groups.hasOwnProperty(groupName)){groups[groupName]=me.getGroup(groupName)}}
return groups;};var getNestedObject=(object,key,value)=>{if(!object)return null;if(Array.isArray(object)){for(const obj of object){const result=getNestedObject(obj,key,value);if(result){return obj;}}}
else{if(object.hasOwnProperty(key)&&object[key]===value){return object;}
for(const k of Object.keys(object)){if(typeof object[k]==="object"){const o=getNestedObject(object[k],key,value);if(o!==null&&typeof o!=='undefined')
return o;}}
return null;}};var getDataHierarchy=function(data){var groupNames=[];var groupBy=null;if(config.groupBy!==null){var groupBy=(config.groupBy+"").trim();if(groupBy.length>0){var map={};data.forEach((d)=>{var group=d[groupBy];map[group]=true;});groupNames=Object.keys(map);}
else{groupBy=null;}}
var arr=[];data.forEach((d)=>{var value=d[config.value];var f=bluewave.chart.utils.parseFloat(value);if(f==0||isNaN(f)){}
else{d[config.value]=f;arr.push(d);}});if(arr.length!==data.length)data=arr;var dataHierarchy={children:[],name:"all"};if(groupBy!==null){groupNames.forEach((g)=>{dataHierarchy["children"].push({"name":g,"children":[],"colname":"level2"});var objectToInsertTo=getNestedObject(dataHierarchy["children"],'name',g);data.forEach((d)=>{var userValue=d[config.key];var groupByValue=d[groupBy];var value=d[config.value];if(g===groupByValue){if(typeof(getNestedObject(objectToInsertTo["children"],"name",userValue))!=="undefined"){var userRecord=getNestedObject(objectToInsertTo["children"],"name",userValue);userRecord["value"]=userRecord["value"]+value;}
else{objectToInsertTo["children"].push({"name":userValue,"group":groupByValue,"colname":"level3","value":value});};};});});var values={};dataHierarchy.children.forEach((d)=>{var val=0;d.children.forEach((c)=>{val+=c.value;});values[d.name]=val;});var del=[];for(var key in values){if(values.hasOwnProperty(key)){var value=values[key];if(value==0)del.push(key);}}
while(del.length>0){var d=del.shift();for(var i=0;i<dataHierarchy.children.length;i++){if(dataHierarchy.children[i].name==d){dataHierarchy.children.splice(i,1);break;}}}
dataHierarchy.children.sort((a,b)=>{return values[b.name]-values[a.name];});groupNames=[];dataHierarchy.children.forEach((d)=>{groupNames.push(d.name);});}
else{dataHierarchy["children"].push({"name":"","children":[],"colname":"level2"});var objectToInsertTo=getNestedObject(dataHierarchy["children"],'name',"");data.forEach((d)=>{var userValue=d[config.key];var value=d[config.value];var groupByValue="";if(typeof(getNestedObject(objectToInsertTo["children"],"name",userValue))!=="undefined"){var userRecord=getNestedObject(objectToInsertTo["children"],"name",userValue);userRecord["value"]=userRecord["value"]+value;}
else{objectToInsertTo["children"].push({"name":userValue,"group":groupByValue,"colname":"level3","value":value});};});};var root=d3.hierarchy(dataHierarchy).sum((d)=>d.value);var leaves=root.leaves();var descendants=root.descendants().filter((d)=>d.depth==1);return{root:root,leaves:leaves,descendants:descendants,groupNames:groupNames,children:dataHierarchy["children"]};};var renderChart=function(data){data=getDataHierarchy(data);var groupNames=data.groupNames;if(typeof(groupNames)==="undefined"||groupNames===null){groupNames=[];}
var colors=config.colors;var numColors=groupNames.length;if(numColors>colors.length){colors=getColorRange(numColors,colors);}
getColor=function(groupName){var color=colors[0];for(var i=0;i<groupNames.length;i++){if(groupNames[i]===groupName){color=colors[i];break;}}
return color;};var rect=javaxt.dhtml.utils.getRect(svg.node());if(config.shape==="circle"){renderVoronoi(data,rect);}
else{renderTiles(data,rect);}};var renderTiles=function(data,rect){var groupPadding=0;if(config.groupLabel&&data.descendants.length>1){var text=plotArea.append("text").attr("x",0).attr("y",0).attr("text-anchor","start").text("Iq");setStyle(text,config.style.groupLabel);groupPadding=text.node().getBBox().height;text.remove();}
plotArea.attr("class","treemap");d3.treemap().size([rect.width,rect.height]).paddingTop(groupPadding).paddingInner(0)
(data.root);var opacity=function(currValue,groupName){var parsingObject=getNestedObject(data["children"],"name",groupName);var values=new Array();parsingObject["children"].forEach(d=>{values.push(d["value"]);});var calculatedScale=d3.scaleLinear().domain([d3.min(values),d3.max(values)]).range([.5,1]);return calculatedScale(currValue);};cells=plotArea.selectAll("rect").data(data.leaves).enter().append("rect").attr('x',(d)=>d.x0).attr('y',(d)=>d.y0).attr('width',(d)=>d.x1-d.x0).attr('height',(d)=>d.y1-d.y0).style("stroke","white").style("fill",(d)=>getColor(d.parent.data.name)).style("opacity",(d)=>opacity(d.data.value,d.data.group)).on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave).on("click",function(e,d){me.onClick(this,d.data);}).on("dblclick",function(e,d){me.onDblClick(this,d.data);});var yOffsets=[];var labelPadding=3;if(config.keyLabel){cells.each(function(n){var label=me.getKeyLabel(n.data.name,n.data);var rect=d3.select(this).node();var box=rect.getBBox();var maxX=box.x+box.width;var maxY=box.y+box.height;var text=plotArea.append("text").attr("x",box.x+2).attr("y",box.y).attr("text-anchor","start").attr("class","label").text(label);setStyle(text,config.style.keyLabel);var t=text.node().getBBox();text.attr("y",box.y+(t.height/2)+labelPadding);t=text.node().getBBox();var right=t.x+t.width;var bottom=t.y+t.height;var yOffset=0;if(right>maxX){text.remove();}
else{if(bottom>maxY){text.remove();}
else{yOffset=t.y+t.height;}}
yOffsets.push(yOffset);});};if(config.valueLabel){cells.each(function(n,i){var yOffset=yOffsets[i];if(yOffset===0&&config.keyLabel)return;var label=me.getValueLabel(n.data.value,n.data);var rect=d3.select(this).node();var box=rect.getBBox();var maxX=box.x+box.width;var maxY=box.y+box.height;var text=plotArea.append("text").attr("x",box.x+2).attr("y",box.y).attr("text-anchor","start").attr("class","value label").text(label);setStyle(text,config.style.valueLabel);var t=text.node().getBBox();text.attr("y",yOffset+(t.height/2));t=text.node().getBBox();var right=t.x+t.width;var bottom=t.y+t.height;if(right>maxX){text.remove();}
else{if(bottom>maxY){text.remove();}}});};if(config.groupLabel&&groupPadding>0){var groupLabels=plotArea.selectAll("titles").data(data.descendants).enter().append("text").attr("class","group label").attr("x",(d)=>d.x0+1).attr("y",(d)=>d.y0+groupPadding-labelPadding).text((d)=>d.data.name).attr("fill",(d)=>getColor(d.data.name));var arr=[];groupLabels.each(function(n,i){setStyle(this,config.style.groupLabel);var box=this.getBBox();var right=box.x+box.width;var maxX=0;n.children.forEach((child)=>{maxX=Math.max(child.x1,maxX);});if(right>maxX){arr.push(d3.select(this));}});arr.forEach((groupLabel)=>{groupLabel.remove();});};};var renderVoronoi=function(data,rect){var width=rect.width;var height=rect.height;var radius=(Math.min(width,height)/2)-5;var center=[width/2,height/2];var treemapContainer=plotArea.append("g").attr("transform","translate("+center+")").attr("class","voronoi treemap");var polygon=getPoints(60,radius);treemapContainer.append("path").attr("transform","translate("+[-radius,-radius]+")").attr("d","M"+polygon.join(",")+"Z");d3.voronoiTreemap().clip(polygon)(data.root);cells=treemapContainer.append("g").attr("transform","translate("+[-radius,-radius]+")").selectAll("path").data(data.leaves).enter().append("path").attr("d",function(d){return"M"+d.polygon.join(",")+"z";}).style("fill",(d)=>getColor(d.parent.data.name)).style("stroke","white").on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave).on("click",function(e,d){me.onClick(this,d.data);}).on("dblclick",function(e,d){me.onDblClick(this,d.data);});var labelGroup;var centroids;if(config.keyLabel||config.valueLabel){labelGroup=treemapContainer.append("g").attr("transform","translate("+[-radius,-radius]+")");centroids=[];cells.each(function(n){var centroid=d3.polygonCentroid(n.polygon);centroids.push(centroid);});}
var yOffsets=[];if(config.keyLabel){cells.each(function(n,i){var label=me.getKeyLabel(n.data.name,n.data);var centroid=centroids[i];var text=labelGroup.append("text").attr("x",centroid[0]).attr("y",centroid[1]).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("class","label").text(label);setStyle(text,config.style.keyLabel);var yOffset=0;if(intersects(text,n)){text.remove();}
else{var t=text.node().getBBox();yOffset=t.y+t.height+4;}
yOffsets.push(yOffset);});}
if(config.valueLabel){cells.each(function(n,i){var yOffset=yOffsets[i];if(yOffset===0&&config.keyLabel)return;var label=me.getValueLabel(n.data.value,n.data);var centroid=centroids[i];var text=labelGroup.append("text").attr("x",centroid[0]).attr("y",yOffset).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("class","value label").text(label);setStyle(text,config.style.valueLabel);var t=text.node().getBBox();if(t.y<yOffset){text.attr("y",yOffset);}
if(intersects(text,n)){text.remove();}});}};var getPoints=function(numPoints,radius){var increment=(2*Math.PI)/numPoints;var points=[];for(var a=0,i=0;i<numPoints;i++,a+=increment){points.push([radius+radius*Math.cos(a),radius+radius*Math.sin(a)]);}
return points;};var mouseover=function(e,d){if(tooltip){var i=cells.nodes().indexOf(this);var label=me.getTooltipLabel(d.data,i);tooltip.html(label).show();}
d3.select(this).transition().duration(100).attr("opacity","0.8");};var mousemove=function(e){if(tooltip)tooltip.style('top',(e.clientY)+"px").style('left',(e.clientX+20)+"px");};var mouseleave=function(){if(tooltip)tooltip.hide();d3.select(this).transition().duration(100).attr("opacity","1");};var intersects=function(text,n){var t=text.node().getBBox();var p=[[t.x,t.y],[t.x+t.width,t.y],[t.x+t.width,t.y+t.height],[t.x,t.y+t.height],[t.x,t.y]];var clip=bluewave.chart.utils.clipPolygon(n.polygon,p);var removeLabel=true;if(clip){if(clip.length===5){var numMatches=0;for(var i=0;i<clip.length;i++){var a=clip[i];var b=p[i];if(a[0]===b[0]&&a[1]===b[1]){numMatches++;}}
if(numMatches===5){removeLabel=false;}}}
else{removeLabel=false;}
return removeLabel;};var merge=javaxt.dhtml.utils.merge;var checkSVG=bluewave.chart.utils.checkSVG;var round=javaxt.dhtml.utils.round;var initChart=bluewave.chart.utils.initChart;var createTooltip=bluewave.chart.utils.createTooltip;var setStyle=bluewave.chart.utils.setStyle;var getColorRange=bluewave.chart.utils.getColorRange;init();};
if(!bluewave)var bluewave={};if(!bluewave.chart)bluewave.chart={};bluewave.chart.utils={initChart:function(parent,callback,scope){var onReady=function(){var g=svg.append("g");if(callback)callback.apply(scope,[svg,g]);};var svg;if(parent instanceof d3.selection){svg=parent;onReady();}
else if(parent instanceof SVGElement){svg=d3.select(parent);onReady();}
else{var p=d3.select(parent).append("div").classed("svg-container",true);var svg=p.append("svg").attr("preserveAspectRatio","xMidYMid meet").attr("height","100%").attr("width","100%").attr("viewBox","0 0 600 400").classed("svg-content-responsive",true);bluewave.chart.utils.onRender(parent,function(){setTimeout(function(){var width=parent.offsetWidth;var height=parent.offsetHeight;svg.attr("viewBox",`0 0 ${width} ${height}`);onReady();},200);});}},checkSVG:function(chart,callback){var svg=chart.getSVG();if(!svg){var timer;var checkSVG=function(){var svg=chart.getSVG();if(!svg){timer=setTimeout(checkSVG,100);}
else{clearTimeout(timer);if(callback)callback.apply(chart,[svg]);}};timer=setTimeout(checkSVG,100);}
else{if(callback)callback.apply(chart,[svg]);}},onRender:function(el,callback){var w=el.offsetWidth;if(w===0||isNaN(w)){var timer;var checkWidth=function(){var w=el.offsetWidth;if(w===0||isNaN(w)){timer=setTimeout(checkWidth,100);}
else{clearTimeout(timer);if(callback)callback.apply(el,[el]);}};timer=setTimeout(checkWidth,100);}
else{if(callback)callback.apply(el,[el]);}},drawGridlines:function(svg,xScale,yScale,height,width,xGrid,yGrid){var gridLines=[];if(xGrid===true||!isNaN(xGrid)){var g=svg.append("g").attr("class","vertical grid").attr("transform","translate(0,"+height+")");gridLines.push(g);var fn;if(xGrid===true){fn=d3.axisBottom(xScale).tickSize(-height).tickFormat("");}
else{fn=d3.axisBottom(xScale).ticks(xGrid).tickSize(-height).tickFormat("");}
g.call(fn);}
if(yGrid===true||!isNaN(yGrid)){var g=svg.append("g").attr("class","horizontal grid");gridLines.push(g);var fn;if(yGrid===true){fn=d3.axisLeft(yScale).tickSize(-width).tickFormat("");}
else{fn=d3.axisLeft(yScale).ticks(yGrid).tickSize(-width).tickFormat("");}
g.call(fn);}
gridLines.forEach((axis)=>{axis.node().removeAttribute("font-size");axis.node().removeAttribute("font-family");axis.selectAll("g").each(function(d,i){this.removeAttribute("class");this.removeAttribute("opacity");});});},drawLabels:function(svg,showX,showY,height,width,margin,xLabel,yLabel){if(showX){var y=height;if(margin)y+=margin.bottom-2;svg.append("text").attr("x",width/2).attr("y",y).style("text-anchor","middle").text(xLabel);}
if(showY){var x=0;if(margin)x=x-margin.left;svg.append("text").attr("transform","rotate(-90)").attr("x",0-(height/2)).attr("y",x).attr("dy","1em").style("text-anchor","middle").text(yLabel);}},drawAxes:function(plotArea,axisWidth,axisHeight,xKey,yKey,chartData,minData,chartConfig,chartType){if(!chartConfig)chartConfig={};var getType=bluewave.chart.utils.getType;var getScale=bluewave.chart.utils.getScale;var getDateFormat=bluewave.chart.utils.getDateFormat;var xKeys=[];var yKeys=[];chartData.forEach((d)=>{xKeys.push(d[xKey]);yKeys.push(d[yKey]);});var xType=getType(xKeys);var yType=getType(yKeys);if(chartType=="barChart"){if(xType=="date")xType="string";if(yType=="date")yType="string";if(xType=="number"||xType=="currency"){var layout=chartConfig.layout;if(layout==="vertical"){var minX=Number.MAX_VALUE;var maxX=0;xKeys.forEach((key)=>{var n=bluewave.chart.utils.parseFloat(key);minX=Math.min(n,minX);maxX=Math.max(n,maxX);});chartConfig.xMin=minX;}}}
var sb=getScale(xKey,xType,[0,axisWidth],chartData,minData,null,chartConfig.xMin,chartConfig.xMax);var x=sb.scale;var xBand=sb.band;var scaleOption=chartConfig.scaling==="logarithmic"?"logarithmic":"linear";sb=getScale(yKey,yType,[axisHeight,0],chartData,minData,scaleOption,chartConfig.yMin,chartConfig.yMax);var y=sb.scale;var yBand=sb.band;var updateDefaultTicks=function(axis,type){var numWholeNumbers;var years;var days;axis.selectAll("text").each(function(value,index,nodeList){var label=nodeList[index].textContent;if(type==="number"){if(isNaN(numWholeNumbers)){numWholeNumbers=0;nodeList.forEach(function(n){var wholeNumber=bluewave.chart.utils.parseFloat(n.textContent)%1==0;if(wholeNumber)numWholeNumbers++;});}
if(numWholeNumbers==nodeList.length){var format=d3.format(",");nodeList[index].textContent=format(label);}}
else if(type==="date"){if(!years){years={};days={};nodeList.forEach(function(n){var date=new Date(n.textContent);var y=date.getFullYear();var d=date.getDate();years[y+""]=true;days[d+""]=true;});years=Object.keys(years);days=Object.keys(days);}
var trimZeros=true;if(years.length>1){if(days.length==1){var format=d3.timeFormat("%Y");label=format(value);trimZeros=false;}}
else{if(days.length==1){var format=d3.timeFormat("%b");label=format(value);}}
if(trimZeros){if(label.indexOf("0")===0)label=label.substring(1);label=label.replaceAll("/0","/");}
nodeList[index].textContent=label;}});};var getTickFormat=function(type,pattern){var format;if(type==="date"){format=d3.timeFormat(getDateFormat(pattern));}
else if(type==="number"){var numDecimals=1;format=d3.format("."+numDecimals+"f");}
return format;};var getBoxes=function(axis,padding=0){var boxes=[];axis.selectAll("text").each(function(d,i){var box=javaxt.dhtml.utils.getRect(this);boxes.push({left:box.x-padding,right:box.x+box.width+padding,top:box.y-padding,bottom:box.y+box.height+padding});});return boxes;};var foundIntersection=function(boxes){var foundIntersection=false;for(var i=0;i<boxes.length;i++){var box=boxes[i];for(var j=0;j<boxes.length;j++){if(j===i)continue;var b=boxes[j];if(javaxt.dhtml.utils.intersects(box,b)){foundIntersection=true;break;}}
if(foundIntersection)break;}
return foundIntersection;};var xFormat=getTickFormat(xType,chartConfig.xFormat);var xTicks;if(!(chartConfig.xTicks===true||chartConfig.xTicks===false)){xTicks=chartConfig.xTicks;}
var xAxis=plotArea.append("g").attr("transform","translate(0,"+axisHeight+")");if(chartConfig.xTicks===false){xAxis.call(d3.axisBottom(x).ticks(xTicks).tickSize([0,0]));xAxis.selectAll("text").each(function(d,i){d3.select(this).remove();});xAxis.selectAll("path").each(function(d,i){d3.select(this).remove();});}
else{xAxis.call(d3.axisBottom(x).ticks(xTicks).tickFormat(xFormat));if(!chartConfig.xFormat)updateDefaultTicks(xAxis,xType);var padding=parseFloat(chartConfig.labelPadding+"");if(isNaN(padding))padding=3;var xBoxes=getBoxes(xAxis,padding);var xLabelsIntersect=foundIntersection(xBoxes);if(xLabelsIntersect){xAxis.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var hide={};for(var i=0;i<xBoxes.length;i++){xBoxes[i]=bluewave.chart.utils.rotateBox(xBoxes[i],315);}
for(var i=xBoxes.length-1;i>=0;i--){var polygon=xBoxes[i];for(var j=i-1;j>=0;j--){var nextPoly=xBoxes[j];var intersects=false;for(var k=0;k<nextPoly.length;k++){var point=nextPoly[k];if(bluewave.chart.utils.pointInPoly(point,polygon)){intersects=true;break;}}
if(intersects){hide[j+""]=true;i--;}
else{break;}}}
xAxis.selectAll("text").attr("visibility",function(text,i){if(hide[i+""])return"hidden";return"visible";});}}
var yFormat=getTickFormat(yType,chartConfig.yFormat);var yTicks;if(!(chartConfig.yTicks===true||chartConfig.yTicks===false)){yTicks=chartConfig.yTicks;}
var yAxis=plotArea.append("g");if(chartConfig.yTicks===false){yAxis.call(scaleOption==="linear"?d3.axisLeft(y).tickFormat(yFormat).tickSize([0,0]):d3.axisLeft(y).ticks(10,",").tickFormat(yFormat).tickSize([0,0]));yAxis.selectAll("text").each(function(d,i){d3.select(this).remove();});yAxis.selectAll("path").each(function(d,i){d3.select(this).remove();});}
else{yAxis.call(scaleOption==="linear"?d3.axisLeft(y).ticks(yTicks).tickFormat(yFormat):d3.axisLeft(y).ticks(10,",").tickFormat(yFormat));if(!chartConfig.yFormat)updateDefaultTicks(yAxis,yType);var labels=yAxis.selectAll("text");let length=labels.size();var yBoxes=getBoxes(yAxis);var yLabelsIntersect=foundIntersection(yBoxes,-1);if(yLabelsIntersect){labels.attr("visibility",function(text,i){if(length%2){return(i+1)%2===0?"hidden":"visible";}
else return i%2===0?"hidden":"visible";});}}
[xAxis,yAxis].forEach((axis)=>{axis.node().setAttribute("class","axis");axis.node().removeAttribute("font-size");axis.node().removeAttribute("font-family");axis.selectAll("g").each(function(d,i){this.removeAttribute("opacity");this.removeAttribute("class");});axis.selectAll("text").each(function(d,i){this.setAttribute("class","label");});axis.selectAll("line").each(function(d,i){this.setAttribute("class","tick");});});var xExtents=javaxt.dhtml.utils.getRect(xAxis.node());var yExtents=javaxt.dhtml.utils.getRect(yAxis.node());var left=Number.MAX_VALUE;var right=0;var top=Number.MAX_VALUE;var bottom=0;xAxis.selectAll("line").each(function(d,i){var box=javaxt.dhtml.utils.getRect(this);left=Math.min(box.x,left);right=Math.max(box.x+box.width,right);});yAxis.selectAll("line").each(function(d,i){var box=javaxt.dhtml.utils.getRect(this);top=Math.min(box.y,top);bottom=Math.max(box.y+box.height,bottom);});yAxis.selectAll("path").each(function(d,i){var box=javaxt.dhtml.utils.getRect(this);top=Math.min(box.y,top);bottom=Math.max(box.y+box.height,bottom);});var marginLeft=xExtents.left-left;if(marginLeft<0)marginLeft=0;var marginRight=(xExtents.right-right);if(marginRight<0)marginRight=0;marginLeft=Math.max(yExtents.width,marginLeft);var marginTop=top-yExtents.top;var marginBottom=xExtents.height;var labelOffset=16;var xLabel=chartConfig.xLabel;if(xLabel){var t=xAxis.append("text").attr("x",(xExtents.right-xExtents.left)/2).attr("y",marginBottom+labelOffset).attr("class","chart-axis-label").style("text-anchor","middle").text(xLabel);var r=javaxt.dhtml.utils.getRect(t.node());marginBottom+=(r.height+labelOffset);}
var yLabel=chartConfig.yLabel;if(yLabel){var t=yAxis.append("text").attr("transform","rotate(-90)").attr("x",-(yExtents.height/2)).attr("y",-(yExtents.width+labelOffset)).attr("class","chart-axis-label").style("text-anchor","middle").text(yLabel);var r=javaxt.dhtml.utils.getRect(t.node());marginLeft=Math.max(marginLeft+(r.width+labelOffset),marginLeft);}
return{xAxis:xAxis,yAxis:yAxis,xBand:xBand,yBand:yBand,x:x,y:y,margin:{top:marginTop,right:marginRight,bottom:marginBottom,left:marginLeft}};},getScale:function(key,type,axisRange,chartData,minData,scaleOption,_minVal,_maxVal){let scale;let band;switch(type){case"string":scale=d3.scaleBand().domain(chartData.map(function(d){return d[key];})).range(axisRange).padding(0.2);break;case"date":var timeRange=[new Date(d3.min(chartData,d=>d[key])),new Date(d3.max(chartData,d=>d[key]))];chartData.map((val)=>{val[key]=new Date(val[key]);return val;});scale=d3.scaleTime().domain(timeRange).rangeRound(axisRange);band=d3.scaleBand().domain(d3.timeDay.range(...scale.domain())).rangeRound(axisRange).padding(0.2);break;default:var minVal,maxVal;if(!minData){var extent=d3.extent(chartData,function(d){return bluewave.chart.utils.parseFloat(d[key]);});minVal=0;maxVal=extent[1];}
else{minVal=d3.min(minData,function(d){return bluewave.chart.utils.parseFloat(d[key]);});maxVal=d3.max(chartData,function(d){return bluewave.chart.utils.parseFloat(d[key]);});}
if(minVal===maxVal)maxVal=minVal+1;if(!scaleOption)scaleOption="linear";if(scaleOption==="linear"){if(minVal>0)minVal=0;if(!isNaN(_minVal)){minVal=_minVal;}
if(!isNaN(_maxVal)){maxVal=_maxVal;}
scale=d3.scaleLinear().domain([minVal,maxVal]);}
else if(scaleOption==="logarithmic"){if(minVal<1)minVal=1;scale=d3.scaleLog().domain([minVal,maxVal+1]);}
scale.range(axisRange);break;}
return{scale,band};},extendScale:function(scaleBandObj,axisRange,scalingFactor,type){var domain=scaleBandObj.scale.domain();var scale,band;var getType=bluewave.chart.utils.getType;if(!type)type=getType(domain[0]);if(!scalingFactor)scalingFactor=1;if(type==='date'){let endDate=domain[1];let startDate=domain[0];let dateinMilliseconds=endDate.getTime();let timeDiff=endDate-startDate;let timetoAdd=timeDiff*scalingFactor;let extendedDate=new Date(dateinMilliseconds+timetoAdd);scale=d3.scaleTime().domain([startDate,extendedDate]).rangeRound(axisRange);band=d3.scaleBand().domain(d3.timeDay.range(...scale.domain())).rangeRound(axisRange).padding(0.2);}
else if(type==='string'){let numExtraTicks=Math.ceil(domain.length*scalingFactor);let spaceString="";let ordinalDomain=domain;for(let i=0;i<numExtraTicks;i++){spaceString=spaceString+" ";ordinalDomain.push(spaceString);}
scale=d3.scaleBand().domain(ordinalDomain).range(axisRange).padding(0.2);}
else{let numDomain=[domain[0],domain[1]*(scalingFactor+1)]
scale=d3.scaleLinear().domain(numDomain).range(axisRange);}
return{scale:scale,band:band};},reDrawAxes:function(svg,xAxis,x,yAxis,y,axisHeight){if(xAxis){xAxis.remove();xAxis=svg.append("g").attr("transform","translate(0,"+axisHeight+")").call(d3.axisBottom(x));}
if(yAxis){yAxis.remove();yAxis=svg.append("g").call(d3.axisLeft(y));}},getType:function(value){var getType=bluewave.chart.utils.getType;var isDate=bluewave.chart.utils.isDate;var isNumber=bluewave.chart.utils.isNumber;var isCurrency=bluewave.chart.utils.isCurrency;var isArray=bluewave.chart.utils.isArray;if(isArray(value)){var len=value.length;var numbers=0;var currencies=0;var dates=0;var strings=0;var noval=0;var other=0;value.forEach(function(val){if(val===null||typeof val==='undefined'){noval++;return;}
var dataType=getType(val);switch(dataType){case"string":var s=(val+"").trim();if(s.length===0||s==="null"){noval++;}
strings++;break;case"number":numbers++;break;case"currency":currencies++;break;case"date":dates++;break;default:other++;break;}});if(dates===len||dates+noval===len)return"date";if(numbers===len||numbers+noval===len)return"number";if(currencies===len||currencies+noval===len||currencies+numbers+noval===len)return"currency";if(strings===len||strings+noval===len)return"string";return null;}
else{switch(typeof value){case"string":if(isNumber(value)){return"number";}
else if(isDate(value)){return"date";}
else if(isCurrency(value)){return"currency";}
else{return"string";}
break;case"number":return"number";break;case"object":if(isDate(value)){return"date";}
break;default:break;}
return null;}},parseFloat:function(n){if(typeof n==="number")return n;if(typeof n==="string"){if(bluewave.chart.utils.isDate(n))return parseFloat(null);if(bluewave.chart.utils.isCurrency(n)){return bluewave.chart.utils.parseCurrency(n);}}
return parseFloat(n);},parseCurrency:function(n){var words=n.split(" ");for(var i=0;i<words.length;i++){n=words[i].trim();if(bluewave.chart.utils.isCurrency(n)){var x=1;if(n.indexOf("-")==0){x=-1;}
if(n.indexOf("(")==0&&n.lastIndexOf(")")==n.length-1){x=-1;}
var dotPos=n.indexOf('.');var commaPos=n.indexOf(',');if(dotPos<0)
dotPos=0;if(commaPos<0)
commaPos=0;var sep;if((dotPos>commaPos)&&dotPos)
sep=dotPos;else{if((commaPos>dotPos)&&commaPos)
sep=commaPos;else
sep=false;}
if(sep==false)
return parseFloat(n.replace(/[^\d]/g,""))*x;return parseFloat(n.substr(0,sep).replace(/[^\d]/g,"")+'.'+
n.substr(sep+1,n.length).replace(/[^0-9]/,""))*x;}}
return parseFloat(null);},isArray:function(obj){return(Object.prototype.toString.call(obj)==='[object Array]');},isNumber:function(n){if(typeof n==="number")return true;if(typeof n!=="string")n=""+n;return!isNaN(parseFloat(n))&&!isNaN(n-0);},isCurrency:function(n){if(bluewave.chart.utils.isNumber(n))return true;if(bluewave.chart.utils.isDate(n))return false;if(typeof n!=="string")n=""+n;var t=n.replace(/[-+,.a-zA-Z0-9() ]+/g,"");t=t.replace(bluewave.chart.utils.getCurrencyRegEx(),"");if(t.length>0)return false;var wordCount=0;var words=n.split(" ");for(var i=0;i<words.length;i++){var word=words[i].trim();if(word.length>0){if(word.indexOf("-")==0||word.indexOf("+")==0){word=word.substring(1).trim();}
if(word.indexOf("(")==0&&word.lastIndexOf(")")==word.length-1){word=word.substring(1,word.length-1).trim();}
var startWithNumber=/^\d/.test(word);var endsWithNumber=/[0-9]+$/.test(word);if(startWithNumber&&endsWithNumber){var t=word.replace(/[^0-9,.]+/g,"");return t===word;}
else{if(startWithNumber||endsWithNumber){return bluewave.chart.utils.isNumber(n.replace(/[^0-9.-]+/g,""));}}
wordCount++;}
if(wordCount>3)return false;}
return false;},isDate:function(d){if(d instanceof Date)return true;if(bluewave.chart.utils.isNumber(d))return false;if(typeof d!=="string")d=d+"";d=d.trim();if(d.match(/^[-+]/))return false;if(d.match(bluewave.chart.utils.getCurrencyRegEx()))return false;d=Date.parse(d);return!isNaN(d)&&d!==0;},getCurrencyRegEx:function(){return/[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]/;},getDateFormat:function(pattern){var dateFormat="%m/%d/%Y";if(pattern){dateFormat=pattern;dateFormat=dateFormat.replace("YYYY","%Y");dateFormat=dateFormat.replace("YY","%y");dateFormat=dateFormat.replace("MMMM","%B");dateFormat=dateFormat.replace("MM","%m");dateFormat=dateFormat.replace("M","%m");dateFormat=dateFormat.replace("DD","%d");dateFormat=dateFormat.replace("D","%d");dateFormat=dateFormat.replace("A","%p");dateFormat=dateFormat.replace("dddd","%A");dateFormat=dateFormat.replace("HH","%H");dateFormat=dateFormat.replace("h","%I");dateFormat=dateFormat.replace("mm","%M");dateFormat=dateFormat.replace("ss","%S");}
return dateFormat;},mixColors:function(color1,color2,ratio){if(typeof chroma!=='undefined'){return chroma.mix(color1,color2,ratio,'rgb').hex();}
else{var getColor=d3.scaleLinear().domain([0,1]).range([color1,color2]);return d3.color(getColor(ratio)).formatHex();}},getColorRange:function(numColors,colors){if(typeof chroma!=='undefined'){return chroma.scale(colors).colors(numColors);}
else{var domain=[-1];var increment=2/(colors.length-1);for(var i=0;i<colors.length-2;i++){var previous=domain[domain.length-1];domain.push(previous+increment);}
domain.push(1);var getColor=d3.scaleLinear().domain(domain).range(colors);var arr=[];for(var i=0;i<numColors;i++){var p=i/(numColors-1);var x=(p*2)-1;var color=d3.color(getColor(x)).formatHex();arr.push(color);}
return arr;}},getNaturalBreaks:function(data,n_classes){var numDistinctVals=[...new Set(data)].length;n_classes=Math.min(n_classes,numDistinctVals-1);function getMatrices(data,n_classes){var lower_class_limits=[],variance_combinations=[],i,j,variance=0;for(i=0;i<data.length+1;i++){var tmp1=[],tmp2=[];for(j=0;j<n_classes+1;j++){tmp1.push(0);tmp2.push(0);}
lower_class_limits.push(tmp1);variance_combinations.push(tmp2);}
for(i=1;i<n_classes+1;i++){lower_class_limits[1][i]=1;variance_combinations[1][i]=0;for(j=2;j<data.length+1;j++){variance_combinations[j][i]=Infinity;}}
for(var l=2;l<data.length+1;l++){var sum=0,sum_squares=0,w=0,i4=0;for(var m=1;m<l+1;m++){var lower_class_limit=l-m+1,val=data[lower_class_limit-1];w++;sum+=val;sum_squares+=val*val;variance=sum_squares-(sum*sum)/w;i4=lower_class_limit-1;if(i4!==0){for(j=2;j<n_classes+1;j++){if(variance_combinations[l][j]>=(variance+variance_combinations[i4][j-1])){lower_class_limits[l][j]=lower_class_limit;variance_combinations[l][j]=variance+
variance_combinations[i4][j-1];}}}}
lower_class_limits[l][1]=1;variance_combinations[l][1]=variance;}
return{lower_class_limits:lower_class_limits,variance_combinations:variance_combinations};}
function breaks(data,lower_class_limits,n_classes){var k=data.length-1,kclass=[],countNum=n_classes;kclass[n_classes]=data[data.length-1];kclass[0]=data[0];while(countNum>1){kclass[countNum-1]=data[lower_class_limits[k][countNum]-2];k=lower_class_limits[k][countNum]-1;countNum--;}
return kclass;}
if(n_classes>data.length){return null;}
data=data.slice().sort(function(a,b){return a-b;});var matrices=getMatrices(data,n_classes),lower_class_limits=matrices.lower_class_limits;var arr=[];try{arr=breaks(data,lower_class_limits,n_classes);arr=[...new Set(arr)];}
catch(e){console.log(e);}
return arr;},createTooltip:function(cls){var tooltip=bluewave.chart.utils.Tooltip;var getHighestElements=javaxt.dhtml.utils.getHighestElements;if(!tooltip){tooltip=bluewave.chart.utils.Tooltip=d3.select(document.body).append("div").style("position","absolute").style("opacity",0).style("top",0).style("left",0).style("display","none").attr("class",cls?cls:"tooltip");tooltip.show=function(){var highestElements=getHighestElements();var zIndex=highestElements.zIndex;if(!highestElements.contains(tooltip.node()))zIndex++;tooltip.style("opacity",1).style("display","block").style("z-index",zIndex);};tooltip.hide=function(){tooltip.style("opacity",0).style("display","none");};}
return tooltip;},setStyle:function(el,style){if(el===null||el===0)return;if(style===null)return;var nodeName=el.nodeName;if(!nodeName){if(el.node){el=el.node();nodeName=el.nodeName;}}
if(typeof style==='string'||style instanceof String){el.setAttribute("class",style);}
else{for(var key in style){var val=style[key];if(nodeName==="text"){if(key==="color")key="fill";}
el.setAttribute(key,val);}}},rotateBox:function(box,deg){var angleInRad=deg*Math.PI/180;var rotatePoint=function(pivot,point,angle){var x=Math.round((Math.cos(angle)*(point[0]-pivot[0]))-
(Math.sin(angle)*(point[1]-pivot[1]))+
pivot[0]),y=Math.round((Math.sin(angle)*(point[0]-pivot[0]))+
(Math.cos(angle)*(point[1]-pivot[1]))+
pivot[1]);return[x,y];};var pivot=[box.right,box.top];return[pivot,rotatePoint(pivot,[box.right,box.bottom],angleInRad),rotatePoint(pivot,[box.left,box.bottom],angleInRad),rotatePoint(pivot,[box.left,box.top],angleInRad)];},pointInPoly:function(point,vs){var x=point[0],y=point[1];var inside=false;for(var i=0,j=vs.length-1;i<vs.length;j=i++){var xi=vs[i][0],yi=vs[i][1];var xj=vs[j][0],yj=vs[j][1];var intersect=((yi>y)!=(yj>y))&&(x<(xj-xi)*(y-yi)/(yj-yi)+xi);if(intersect)inside=!inside;}
return inside;},clipPolygon:function(clip,subject){function lineOrient([px,py],[ax,ay],[bx,by]){return(bx-ax)*(py-ay)<(by-ay)*(px-ax);}
function lineIntersect([ax,ay],[bx,by],[cx,cy],[dx,dy]){const bax=bx-ax,bay=by-ay,dcx=dx-cx,dcy=dy-cy;const k=(bax*(cy-ay)-bay*(cx-ax))/(bay*dcx-bax*dcy);return[cx+k*dcx,cy+k*dcy];}
function polygonClosed(points){const[ax,ay]=points[0],[bx,by]=points[points.length-1];return ax===bx&&ay===by;}
const closed=polygonClosed(subject);const n=clip.length-polygonClosed(clip);subject=subject.slice();for(let i=0,a=clip[n-1],b,c,d;i<n;++i){const input=subject.slice();const m=input.length-closed;subject.length=0;b=clip[i];c=input[m-1];for(let j=0;j<m;++j){d=input[j];if(lineOrient(d,a,b)){if(!lineOrient(c,a,b)){subject.push(lineIntersect(c,d,a,b));}
subject.push(d);}else if(lineOrient(c,a,b)){subject.push(lineIntersect(c,d,a,b));}
c=d;}
if(closed)subject.push(subject[0]);a=b;}
return subject.length?subject:null;},createKeyValueDataset:function(data,key,value){var arr=[];var values=[];data.forEach((d)=>{var k=d[key];var v=d[value];arr.push({key:k+"",value:v});values.push(v);});var t=bluewave.chart.utils.getType(values);if(t==="number"||t==="currency"){arr.forEach((d)=>{var v=bluewave.chart.utils.parseFloat(d.value);if(isNaN(v))v=0;d.value=v;});var temp={};arr.forEach((d,idx)=>{var v=arr[idx].value;if(temp.hasOwnProperty(d.key)){temp[d.key]+=v;}
else{temp[d.key]=v;}});arr=[];for(var key in temp){if(temp.hasOwnProperty(key)){var val=temp[key];arr.push({key:key,value:val});}}}
return arr;}};